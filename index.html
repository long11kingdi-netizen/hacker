<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Streaming Website</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #e50914;
            --dark: #141414;
            --gray: #808080;
            --light-gray: #e5e5e5;
            --white: #ffffff;
        }

        body {
            background-color: #0c0c0c;
            color: var(--white);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .logo span {
            color: var(--white);
        }

        .search-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 8px 15px;
            width: 300px;
        }

        .search-container input {
            background: transparent;
            border: none;
            color: var(--white);
            width: 100%;
            font-size: 16px;
            padding: 5px;
        }

        .search-container input:focus {
            outline: none;
        }

        .search-container i {
            color: var(--gray);
            margin-right: 10px;
        }

        /* Main Content Styles */
        .main-content {
            padding: 30px 0;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
        }

.movies-grid {
    display: grid;
    grid-template-columns: repeat(5, 350px); /* 5 c·ªôt 350px */
    justify-content: center;
    gap: 25px;
    margin-bottom: 40px;
}

.movie-card {
    background: #1a1a1a;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    position: relative;
    width: 350px;  /* ph√π h·ª£p v·ªõi grid */
    margin: 0 auto;
}

.movie-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
}

.movie-thumbnail {
    width: 350px;      /* b·∫±ng v·ªõi card */
    height: 250px;
    object-fit: cover;
    display: block;
    margin: 0 auto;
}


        .movie-info {
            padding: 15px;
        }

.movie-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    line-height: 1.4;
    max-height: calc(1.4em * 2);     /* ‚úÖ 2 d√≤ng */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
    text-overflow: ellipsis;
}



        .movie-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 14px;
        }
        
.movie-meta span:first-child {
    display: -webkit-box;
    -webkit-line-clamp: 2;               /* ‚úÖ T·ªëi ƒëa 2 d√≤ng */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: calc(1.4em * 2);         /* ‚úÖ Chi·ªÅu cao t∆∞∆°ng ·ª©ng */
    line-height: 1.4;
}
        .movie-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .tag {
            background: rgba(229, 9, 20, 0.2);
            color: #ff5c66;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Video Player Styles */
/* ·∫®n ph·∫ßn n·ªôi dung ch√≠nh khi player m·ªü */
body.player-open #mainContent {
    display: none !important;
}

/* Player container */
.video-player-container {
    display: none;
    position: fixed;
    inset: 0;
    background: #000; /* ƒê·ªïi t·ª´ rgba -> ƒëen h·∫≥n ƒë·ªÉ kh√¥ng b·ªã "m·ªù m·ªù" */
    z-index: 1000;
    overflow-y: auto;
    animation: fadeIn 0.3s ease;
    padding: 30px 0;
}

/* Animation hi·ªÉn th·ªã player */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Header c·ªßa player */
.player-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 15px;
    border-bottom: 1px solid #333;
}

/* N√∫t ƒë√≥ng player */
.close-player {
    background: transparent;
    border: none;
    font-size: 26px;
    color: #ccc;
    cursor: pointer;
    transition: color 0.2s;
}

.close-player:hover {
    color: var(--primary);
}

/* Video khung ngo√†i */
.video-frame-wrapper {
    position: relative;
    padding-top: 56.25%;
    margin-top: 20px;
    background: #000;
    border-radius: 8px;
    overflow: hidden;
}

/* Video iframe */
.video-frame {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* Ti√™u ƒë·ªÅ video */
.player-title {
    font-size: 28px;
    font-weight: bold;
    margin: 25px 0 15px;
    color: var(--white);
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Th√¥ng tin m√¥ t·∫£ */
.player-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
    color: var(--light-gray);
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

/* Ph·∫ßn m√¥ t·∫£ ch√≠nh */
.player-description {
    background: #1a1a1a;
    padding: 20px 25px;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 0 10px rgba(255,255,255,0.05);
}

.description-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 10px;
}

#player-description {
    color: var(--light-gray);
    line-height: 1.6;
}

/* Tag v√† th·ªÉ lo·∫°i */
.tags-container,
.genres-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 15px 0;
}

.player-tag,
.player-genre {
    background: rgba(255, 255, 255, 0.1);
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 14px;
    color: #ff5c66;
    white-space: nowrap;
}

/* N√∫t xem */
.watch-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--primary);
    color: var(--white);
    padding: 12px 24px;
    font-weight: bold;
    border-radius: 6px;
    text-decoration: none;
    margin-top: 15px;
    transition: background 0.3s ease;
}

.watch-button:hover {
    background: #f40612;
}

        /* Footer Styles */
        footer {
            background: #000;
            padding: 40px 0 20px;
            margin-top: 50px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
        }

        .footer-section {
            flex: 1;
            min-width: 200px;
        }

        .footer-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--white);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid #333;
            margin-top: 30px;
        }

        /* Responsive Design */
       @media (max-width: 768px) {
    .header-container {
        flex-direction: column;
        gap: 15px;
    }


    .search-container {
        width: 100%;
    }

  .pagination ul {
    flex-wrap: wrap;       /* Cho ph√©p xu·ªëng d√≤ng */
    justify-content: center;
    gap: 4px;
  }

  .pagination li a {
    padding: 6px 10px;
    font-size: 14px;
    flex: 0 1 auto;        /* Cho ph√©p co l·∫°i */
    min-width: 36px;       /* v·∫´n ƒë·ªß ch·∫°m tay */
  }

.movies-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px;
}

    .movie-thumbnail {
        width: 100%;
        height: 250px; /* ‚úÖ Mobile: 200px */
        object-fit: cover;
    }

    .video-frame {
        height: 50vh;
    }

    .player-title {
        font-size: 18px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        max-height: calc(1.4em * 3);
    }
      #popup-page-3 .code-grid > div {
    flex: 1 0 45%;
  }

  #popup-page-3 b {
    font-size: 15px;
    padding: 5px 10px;
  }

  #popup-welcome-content {
    padding: 20px;
  }

  #popup-welcome-content h3 {
    font-size: 20px;
  }
}


        /* Ph·∫ßn chuy·ªÉn trang */
.pagination-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 30px 0;
}

#prevPageBtn,
#nextPageBtn {
  background-color: #333;
  color: #fff;
  border: none;
  font-size: 18px;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#prevPageBtn:hover,
#nextPageBtn:hover {
  background-color: #555;
}

#pageInput {
  width: 60px;
  padding: 6px 10px;
  font-size: 16px;
  border-radius: 4px;
  border: 1px solid #666;
  background-color: #1a1a1a;
  color: #fff;
  text-align: center;
}

#totalPages {
  display: none;
}
.video-player-container {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 1000;
  overflow-y: auto;
  animation: fadeIn 0.3s ease;
  padding: 30px 0;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.player-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 15px;
  border-bottom: 1px solid #333;
}

.video-frame-wrapper {
  position: relative;
  padding-top: 56.25%;
  margin-top: 20px;
  background: #000;
  border-radius: 8px;
  overflow: hidden;
}

.video-frame {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

.player-title {
  font-size: 28px;
  font-weight: bold;
  margin-top: 25px;
  margin-bottom: 15px;
  color: var(--white);
}

.player-meta {
  display: flex;
  gap: 20px;
  margin-bottom: 15px;
  flex-wrap: wrap;
  color: var(--light-gray);
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.player-description {
  background: #1a1a1a;
  padding: 20px 25px;
  border-radius: 8px;
  margin-top: 20px;
  box-shadow: 0 0 10px rgba(255,255,255,0.05);
}

.description-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 10px;
}

#player-description {
  color: var(--light-gray);
  line-height: 1.6;
}

.tags-container, .genres-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 15px 0;
}

.player-tag,
.player-genre {
  background: rgba(255, 255, 255, 0.1);
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 14px;
  color: #ff5c66;
  white-space: nowrap;
}

.watch-button {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--primary);
  color: var(--white);
  padding: 12px 24px;
  font-weight: bold;
  border-radius: 6px;
  text-decoration: none;
  margin-top: 15px;
  transition: background 0.3s ease;
}

.watch-button:hover {
  background: #f40612;
}

.close-player {
  background: transparent;
  border: none;
  font-size: 26px;
  color: #ccc;
  cursor: pointer;
  transition: color 0.2s;
}

.close-player:hover {
  color: var(--primary);
}

#year-filter-box {
  display: none;
  position: absolute;
  background: #ffffff;
  border: 1px solid #ccc;
  padding: 12px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  border-radius: 8px;
  top: 100%;
  right: 10px;                 /* ‚úÖ CƒÉn g√≥c ph·∫£i */
  width: max-content;
  max-width: 90vw;            /* ‚úÖ Kh√¥ng v∆∞·ª£t qu√° m√†n h√¨nh */
}


#year-filter-box select {
  margin: 5px;
  padding: 5px;
  font-size: 14px;
  border-radius: 4px;
  border: 1px solid #aaa;
}

#year-filter-box button {
  margin-top: 8px;
  padding: 6px 12px;
  font-size: 14px;
  cursor: pointer;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}

#year-filter-box button:hover {
  background-color: #0056b3;
}

#close-filter-box {
  background-color: transparent;
  border: none;
  font-size: 16px;
  float: right;
  color: #888;
  cursor: pointer;
}

#close-filter-box:hover {
  color: red;
}

/* ‚úÖ Responsive h·ªó tr·ª£ ƒëi·ªán tho·∫°i */
@media (max-width: 600px) {
  #year-filter-box {
    left: 50% !important;
    right: auto !important;
    transform: translateX(-50%);
    width: 90vw;
    max-width: 90vw;
    box-sizing: border-box;
  }

  #year-filter-box select,
  #year-filter-box button {
    width: 100%;
    margin: 6px 0;
    font-size: 16px;
  }
  /* container v·∫´n flex, xu·ªëng d√≤ng n·∫øu c·∫ßn */
  #movies-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: space-between;
  }

  /* card mobile 2 c·ªôt */
  .movie-card {
    flex: 0 0 calc(50% - 4px); /* 2 c·ªôt, tr·ª´ gap */
    max-width: calc(50% - 4px);
    box-sizing: border-box;
  }

  /* h√¨nh thumbnail mobile */
  .movie-thumbnail {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
    border-radius: 8px;
    display: block;
  }
  #close-filter-box {
    float: none;
    text-align: right;
    display: block;
    width: 100%;
  }
#watched-close-btn {
  position: absolute;
  top: -12px; /* n·∫±m g·∫ßn ƒë·ªânh popup */
  right: -12px; /* n·∫±m g·∫ßn g√≥c ph·∫£i c·ªßa popup */
  z-index: 10001;
  color: #fff;
  border: none;
  font-size: 18px;
  padding: 6px 10px;
  border-radius: 50%;
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

#watched-close-btn:hover {
  background-color: #d9363e;
}

  #logo {
    transition: opacity 0.3s ease, visibility 0.3s ease;
    opacity: 1;
    visibility: visible;
    height: auto;
  }

  #logo.hidden {
    opacity: 0;
    visibility: hidden;
    height: 0;
    overflow: hidden;
  }
}



#actor-filter-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;  /* CƒÉn gi·ªØa theo chi·ªÅu ngang */
  margin-top: 10px;
}

#actor-filter-box {
  display: none; /* ·∫®n m·∫∑c ƒë·ªãnh, ch·ªâ hi·ªÉn th·ªã khi t√¨m ƒë√∫ng actor */
}

.actor-checkbox {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  color: #333;
  background: #f9f9f9;
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.actor-checkbox input[type="checkbox"] {
  accent-color: #007bff;
  transform: scale(1.2);
  cursor: pointer;
}

#actor-info-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 12px;
}

#actor-info-box {
  display: none;
  align-items: center;
  gap: 12px;
  background: #f2f2f2;
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 10px 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

#actor-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #007bff;
}

.actor-info-text {
  display: flex;
  flex-direction: column;
  font-size: 14px;
  color: #333;
}

#actor-name {
  font-weight: bold;
  color: #000;
}

#actor-count {
  font-size: 13px;
  color: #666;
}

#search-result-box {
  width: 100%;
  display: flex;
  justify-content: center;
  margin: 10px 0;
  font-size: 15px;
  color: #333;
}

#search-result-text {
  background: #eaf4ff;
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #bcd;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}


.related-videos-list {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}


.related-video-item {
  width: calc(20% - 8px); /* 100% / 5 video - kho·∫£ng gap */
  cursor: pointer;
  box-sizing: border-box;
}



.video-title {
  font-size: 14px;
  font-weight: bold;
  margin-top: 4px;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.4em;
  height: calc(1.4em * 3); /* ƒê·∫£m b·∫£o chi·ªÅu cao ƒë√∫ng 3 d√≤ng */
}




.see-more-button-wrapper {
  display: flex;
  justify-content: center;
  width: 100%;
  margin-top: 24px;
}

.see-more-button {
  padding: 12px 30px;
  background: linear-gradient(135deg, #ff3366, #ff6699);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.3s ease, background 0.4s ease;
  box-shadow: 0 4px 12px rgba(255, 51, 102, 0.4);
}

.see-more-button::before {
  content: "";
  position: absolute;
  top: 0;
  left: -75%;
  width: 50%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  transform: skewX(-20deg);
  transition: left 0.4s ease;
}

.see-more-button:hover::before {
  left: 125%;
}

.see-more-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(255, 51, 102, 0.6);
  background: linear-gradient(135deg, #ff0033, #ff66a3);
}

.see-more-button:active {
  transform: scale(0.96);
  box-shadow: 0 3px 10px rgba(255, 51, 102, 0.5);
}

#suggestions-box div {
  font-size: 14px;
  border-bottom: 1px solid #eee;
}

#popup-welcome {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(30, 30, 30, 0.6);
  backdrop-filter: blur(6px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  animation: fadeIn 0.5s ease-out;
}

#popup-welcome-content {
  background: white;
  color: #222;
  padding: 30px;
  border-radius: 12px;
  max-width: 500px;
  width: 90%;
  text-align: left;
  font-family: 'Segoe UI', sans-serif;
  box-shadow: 0 15px 30px rgba(0,0,0,0.3);
  animation: popupZoom 0.4s ease-out;
}

#popup-welcome-content h3 {
  font-size: 22px;
  margin-bottom: 15px;
}

#popup-welcome-content p {
  margin-bottom: 10px;
  line-height: 1.6;
}

#popup-welcome-content button {
  margin: 10px 5px 0 0;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  background-color: #007BFF;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#popup-welcome-content button:hover {
  background-color: #0056b3;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes popupZoom {
  0% { transform: scale(0.9); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

/* Popup Page 3: Video hay c·ªßa nƒÉm */
#popup-page-3 b {
  display: inline-block;
  padding: 6px 12px;
  background-color: #f0f0f0;
  border-radius: 6px;
  text-align: center;
  width: 100%;
  transition: background-color 0.2s;
  cursor: pointer;
  margin-bottom: 8px;
  font-size: 16px;
}

#popup-page-3 b:hover {
  background-color: #ddd;
  color: #000;
}

/* Layout d√≤ng 3 √¥ */
#popup-page-3 .code-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

#popup-page-3 .code-grid > div {
  flex: 1 0 30%;
  min-width: 80px;
}

#related-videos-list img {

  height: 150px;
  object-fit: cover; /* Gi·ªØ ·∫£nh kh√¥ng b·ªã m√©o nh∆∞ng s·∫Ω crop */
}

/* --- Pagination list --- */
.pagination ul {
  display: flex;
  gap: 6px;
  list-style: none;
  padding: 0;
  margin: 16px 0;
  justify-content: center;
}

.pagination li a {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 6px;
  text-decoration: none;
  background: #555;      /* n·ªÅn x√°m */
  color: #fff;           /* ch·ªØ tr·∫Øng */
  font-size: 14px;
  transition: background 0.2s;
}

.pagination li a:hover {
  background: #777;      /* x√°m s√°ng h∆°n khi hover */
}

.pagination li a.active {
  background: #007bff;   /* xanh d∆∞∆°ng cho trang hi·ªán t·∫°i */
  color: #fff;
  font-weight: bold;
}

/* --- Pagination controls --- */
.pagination-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 10px;
  font-size: 14px;
}

.pagination-controls button {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  background: #555;   /* n·ªÅn x√°m */
  color: #fff;        /* ch·ªØ tr·∫Øng */
  cursor: pointer;
  transition: background 0.2s;
}

.pagination-controls button:hover {
  background: #777;
}

.pagination-controls input {
  width: 50px;
  text-align: center;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

.pagination-controls {
  display: none !important;
}

.movie-link {
  text-decoration: none;   /* b·ªè g·∫°ch d∆∞·ªõi */
  color: inherit;          /* gi·ªØ nguy√™n m√†u ch·ªØ */
  display: block;          /* ƒë·ªÉ bao to√†n b·ªô card */
}
.movie-link:hover {
  text-decoration: none;   /* khi hover c≈©ng kh√¥ng g·∫°ch */
}
  #actor-filter-wrapper {
    position: absolute;
    width: 0;
    height: 0;
    overflow: hidden;
  }

    /* ·∫®n n√∫t nh∆∞ng v·∫´n gi·ªØ trong DOM */
  #home-btn,
  #quick-search-btn {
    position: absolute;   /* gi·ªØ v·ªã tr√≠ */
    width: 1px;           /* gi·∫£m k√≠ch th∆∞·ªõc */
    height: 1px;
    overflow: hidden;
    border: none;
    padding: 0;
    margin: 0;
    clip: rect(0,0,0,0);  /* ·∫©n ho√†n to√†n */
  }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="#" id="logo" class="logo">MOVIE<span>STREAM</span></a>

            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="T√¨m ki·∫øm phim...">
<!-- N√∫t c·∫≠p nh·∫≠t -->
<button id="update-btn" title="Th√¥ng tin c·∫≠p nh·∫≠t">üîî</button>

<!-- Popup c·∫≠p nh·∫≠t -->
<div id="update-box" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; border:1px solid #ccc; padding:20px; z-index:1000; color:#000; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.2); max-width:400px; width:90%; max-height:80vh; overflow:auto;">

  <div style="display:flex; align-items:center; margin-bottom:10px;">
    <strong style="font-size:20px; color:#d9534f; flex-grow:1;">B·∫¢N UPDATE 0.2</strong>
    <button id="close-update-box" style="font-size:18px; background:transparent; border:none; color:#888; cursor:pointer; margin-left:10px;">‚ùå</button>
  </div>

  <hr style="margin:8px 0;">

  <div id="update-content" style="font-size:14px; line-height:1.6; color:#333;">
    <div style="margin-bottom:10px;">
      <strong>T√≠nh nƒÉng m·ªõi:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>H·ªó tr·ª£ t√¨m ki·∫øm video, di·ªÖn vi√™n, ti√™u ƒë·ªÅ</li>
        <li>G·ª£i √Ω video m·ªôt c√°ch th√¥ng minh h∆°n</li>
        <li>N√∫t h·ªó tr·ª£ khi g·∫∑p l·ªói [‚ö†Ô∏è]</li>
        <li>Th√¥ng b√°o ƒëang t·∫£i trang khi xem video</li>
        <li>Giao di·ªán ng∆∞·ªùi d√πng th√¢n thi·ªán h∆°n</li>
        <li>N√∫t d·ªãch ti√™u ƒë·ªÅ trong trang xem</li>
      </ul>
    </div>
    <div style="margin-bottom:10px;">
      <strong>L·ªói ƒë√£ s·ª≠a:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>Video kh√¥ng xem ƒë∆∞·ª£c</li>
        <li>Kh√¥ng hi·ªán c√°c video g·ª£i √Ω</li>
        <li>Kh√¥ng s·ª≠ d·ª•ng ƒë∆∞·ª£c thanh t√¨m ki·∫øm</li>
      </ul>
    </div>
    <div style="margin-bottom:10px;">
      <strong>Server:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>TƒÉng t·ªëc ƒë·ªô truy c·∫≠p nhanh h∆°n l√∫c tr∆∞·ªõc 5 l·∫ßn</li>
        <li>T·ªëi ∆∞u h√≥a server</li>
        <li>Gi·∫£m thi·ªÉu qu√° t·∫£i d·ªØ li·ªáu</li>
        <li>Kh√¥ng tr√πng l·∫∑p video, ch·ªâ c√≥ 1 video duy nh·∫•t</li>
      </ul>
    </div>
    <div style="margin-bottom:10px;">
      <strong>L·ªói ƒëang s·ª≠a:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>Kh√¥ng th·ªÉ v·ªÅ trang tr∆∞·ªõc</li>
        <li>Server t·ª± ƒë·ªông s·∫≠p</li>
      </ul>
      <!-- Ch·ªØ nh·ªè m·ªù m·ªù -->
      <div style="font-size:12px; color:#888; margin-top:4px;">
        - - - ƒêang t√¨m nguy√™n nh√¢n d·∫´n ƒë·∫øn l·ªói - - -
      </div>
    </div>
  </div>
</div>

<!-- N√∫t HOME thay cho logo -->
<button id="home-btn" title="Trang ch·ªß">üè†</button>

      <!-- ‚úÖ N√∫t t√¨m ki·∫øm nhanh L1 -->
      <button id="quick-search-btn">üïò</button>

<!-- Thay n√∫t üìÖ b·∫±ng n√∫t ‚ö†Ô∏è -->
<button id="year-filter-btn" title="C√°c l·ªói th∆∞·ªùng g·∫∑p">‚ö†Ô∏è</button>

<!-- Popup v·∫´n d√πng year-filter-box -->
<div id="year-filter-box" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; border:1px solid #ccc; padding:20px; z-index:1000; color:#000; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.2); max-width:400px; width:90%; max-height:80vh; overflow:auto;">

  <!-- Header popup -->
  <div style="display:flex; align-items:center; margin-bottom:10px;">
    <strong style="color:#000; font-size:16px; display:flex; align-items:center; white-space:nowrap; flex-grow:1;">
      ‚ö†Ô∏è <span style="margin-left:5px;">C√ÅC L·ªñI TH∆Ø·ªúNG G·∫∂P</span>
    </strong>
    <button id="close-filter-box" style="font-size:18px; background:transparent; border:none; color:#888; cursor:pointer; margin-left:10px;">‚ùå</button>
  </div>

  <hr style="margin:8px 0;">

<!-- N·ªôi dung popup -->
<div id="main-content" style="font-size:14px; line-height:1.5; color:#333;">
  <ul style="padding-left:20px; margin:0;">
    <li>
      <strong>L·ªói Video m·ªù:</strong> Do server video ƒëang t·ª± ƒë·ªông t·ªëi ∆∞u, n√™n video ban ƒë·∫ßu c√≥ th·ªÉ b·ªã m·ªù.  
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Gi·∫£i ph√°p: M·ªü (ph√≥ng to) video, sau ƒë√≥ ƒë·ª£i m·ªôt l√∫c ho·∫∑c tua sang v√†i c·∫£nh th√¨ video s·∫Ω r√µ n√©t tr·ªü l·∫°i.
      </div>
    </li>
    <li>
      <strong>L·ªói Video:</strong> Video gi·∫≠t, lag ho·∫∑c kh√¥ng load ƒë∆∞·ª£c do server qu√° t·∫£i.  
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Gi·∫£i ph√°p: t·∫£i l·∫°i trang ho·∫∑c b√°o v·ªõi admin
      </div>
    </li>
    <li>
      <strong>L·ªói Trang:</strong> Trang l·ªói ho·∫∑c kh√¥ng t·∫£i ƒë∆∞·ª£c trang do h·ªèng ho·∫∑c xung ƒë·ªôt server.  
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Gi·∫£i ph√°p: t·∫£i l·∫°i trang ho·∫∑c b√°o v·ªõi admin
      </div>
    </li>
    <li>
      <strong>L·ªói t√¨m ki·∫øm:</strong> T√¨m ki·∫øm ƒë√∫ng video nh∆∞ng trang t√¨m ki·∫øm kh√¥ng hi·ªán do admin ch∆∞a c·∫≠p nh·∫≠t ƒë·∫ßy ƒë·ªß. 
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Gi·∫£i ph√°p: B√°o ngay v·ªõi admin ‚ùó
      </div>
    </li>
    <li>
      <strong>Link web kh√¥ng load:</strong> Khi tr·ªü v·ªÅ trang tr∆∞·ªõc m√† link thay ƒë·ªïi r·ªìi , nh∆∞ng web v·∫´n ·ªü trang l√∫c tr∆∞·ªõc . Do 1 s·ªë l·ªói v·ªõi server
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Gi·∫£i ph√°p: B√°o ngay v·ªõi admin ngay l·∫≠p t·ª©c ‚ùó
      </div>
    </li>
  </ul>
</div>
</div>




  <div id="main-content">
  <!-- N·ªôi dung s·∫Ω ƒë∆∞·ª£c thay th·∫ø b·∫±ng k·∫øt qu·∫£ t√¨m ki·∫øm -->
</div>


            </div>
        </div>
    </header>

    <!-- Hi·ªÉn th·ªã th√¥ng tin di·ªÖn vi√™n khi t√¨m ƒë√∫ng -->
<div id="actor-info-wrapper">
  <div id="actor-info-box">
    <img id="actor-avatar" src="" alt="Avatar" />
    <div class="actor-info-text">
      <div id="actor-name"></div>
      <div id="actor-count"></div>
    </div>
  </div>
</div>

<div id="actor-filter-wrapper">
  <div id="actor-filter-box">
    <label class="actor-checkbox">
      <input type="checkbox" id="onlyOneActor" />
      Ch·ªâ hi·ªán video c√≥ ƒë√∫ng 1 t√°c gi·∫£ ch√≠nh
    </label>
  </div>
</div>

<div id="search-result-box" style="display: none;">
  <span id="search-result-text"></span>
</div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <h2 class="section-title">Phim ƒê·ªÅ Xu·∫•t</h2>
            <div class="movies-grid" id="movies-container">
                <!-- Movie cards will be generated here by JavaScript -->
            </div>
            
        </div>
    </main>

<!-- Video Player -->
<div class="video-player-container" id="player-container" style="display: none;">
  <div class="container">
    <div class="player-header">
      <a href="#" id="logo" class="logo">MOVIE<span>STREAM</span></a>
      <button class="close-player" id="close-player" title="ƒê√≥ng">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="video-details">
      <h2 class="player-title" id="player-title"></h2>

      <div class="video-frame-wrapper">
        <iframe class="video-frame" id="video-frame" allowfullscreen></iframe>
      </div>

      <div class="player-meta">
        <div class="meta-item">
          <i class="fas fa-star"></i>
          <span id="player-rating">?/10</span>
        </div>
        <div class="meta-item">
          <i class="fas fa-clock"></i>
          <span id="player-duration">? ph√∫t</span>
        </div>
        <div class="meta-item">
          <i class="fas fa-calendar"></i>
          <span id="player-release">20??</span>
        </div>
      </div>

      <div class="player-description">
        <h3 class="description-title">Th√¥ng tin phim</h3>
        <div id="player-description"></div>

        <div class="tags-container" id="player-tags"></div>
        <div class="genres-container" id="player-genres"></div>

<a href="#" class="watch-button" id="source-link" target="_blank"
   style="opacity: 0; pointer-events: auto; position: absolute; z-index: -1;">
  Xem
</a>


        <div class="related-videos" id="related-videos">
  <h3>G·ª£i √Ω kh√°c</h3>
  <div class="related-videos-list" id="related-videos-list"></div>
</div>

      </div>
    </div>
  </div>
</div>



<div id="pagination"></div>

<div class="pagination-controls">
  <button id="prevPageBtn">‚óÄ</button>
  <input type="number" id="pageInput" value="1" min="1" />
  <button id="nextPageBtn">‚ñ∂</button>
  <span id="totalPages">/ 1</span>
</div>

    <!-- Footer -->
    <footer>
        <div class="container">

            <div class="copyright">
                &copy; 2025 MovieStream
            </div>
        </div>

<script src="cosplay.js"></script>
<script src="bigass.js"></script>
<script src="blowjob.js"></script>
<script src="bigtits.js"></script>
<script src="‡∏Ñ‡∏•‡∏¥‡∏õ‡∏´‡∏•‡∏∏‡∏î‡πÑ‡∏ó‡∏¢.js"></script>
<script src="‡∏Ñ‡∏≤‡∏ä‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤.js"></script>
<script src="thai.js"></script>

<!-- Sau ƒë√≥ l√† ƒëo·∫°n x·ª≠ l√Ω ch√≠nh -->
<script>
  const videos = [ ...thai,]; // üëà ƒë√∫ng th·ª© t·ª± mong mu·ªën
  const ITEMS_PER_PAGE = 25;
  let currentPage = 1;
  let currentFiltered = [...videos].reverse(); // ‚úÖ ƒë·∫£o ng∆∞·ª£c ƒë·ªÉ m·ªõi l√™n ƒë·∫ßu

const moviesContainer = document.getElementById('movies-container');
const playerContainer = document.getElementById('player-container');
const videoFrame = document.getElementById('video-frame');
const playerTitle = document.getElementById('player-title');
const playerDescription = document.getElementById('player-description');
const playerTags = document.getElementById('player-tags');
const playerGenres = document.getElementById('player-genres');
const sourceLink = document.getElementById('source-link');
const closePlayer = document.getElementById('close-player');
const searchInput = document.getElementById('search-input');
const pageInput = document.getElementById('pageInput');
const totalPagesEl = document.getElementById('totalPages');
const prevPageBtn = document.getElementById('prevPageBtn');
const nextPageBtn = document.getElementById('nextPageBtn');
const suggestionsBox = document.createElement('div');

// G·ª£i √Ω actor khi g√µ
suggestionsBox.id = 'suggestions-box';
suggestionsBox.style.position = 'absolute';
suggestionsBox.style.background = '#fff';
suggestionsBox.style.border = '1px solid #ccc';
suggestionsBox.style.maxHeight = '200px';
suggestionsBox.style.overflowY = 'auto';
suggestionsBox.style.zIndex = 9999;
suggestionsBox.style.display = 'none';
document.body.appendChild(suggestionsBox);

// -------------------------- H√ÄM CH√çNH --------------------------

function saveCurrentPage() {
  localStorage.setItem('currentVideoPage', currentPage);
}

function loadCurrentPage() {
  const saved = parseInt(localStorage.getItem('currentVideoPage'));
  if (!isNaN(saved)) currentPage = saved;
}

function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderMoviesPage(page, list) {
  // S·∫Øp x·∫øp list theo ng√†y gi·∫£m d·∫ßn (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
  list.sort((a, b) => new Date(b.date) - new Date(a.date));

  const totalPages = Math.ceil(list.length / ITEMS_PER_PAGE);
  if (page < 1) page = 1;
  if (page > totalPages) page = totalPages;

  const start = (page - 1) * ITEMS_PER_PAGE;
  const end = start + ITEMS_PER_PAGE;
  const slice = list.slice(start, end);

  renderMovies(slice);
  pageInput.value = page;
  totalPagesEl.textContent = `/ ${totalPages}`;
  saveCurrentPage();
  scrollToTop();
}


function renderMovies(movies) {
  moviesContainer.innerHTML = '';

  movies.forEach((movie) => {
    const movieCard = document.createElement('div');
    movieCard.className = 'movie-card';

    const videoId = encodeURIComponent(movie.id || movie.code || movie.title);
    const watchUrl = `watch.html?v=${videoId}`;

    // Actors
    const actorsHTML = (movie.actors || [])
      .map(actor => `<span style="cursor: pointer;" data-actor="${actor}">${actor}</span>`)
      .join(', ');

    // Tags
    const tagsHTML = (movie.tags || [])
      .map(tag => `<span class="tag" data-tag="${tag}">${tag}</span>`)
      .join('');

    // Card HTML (b·ªçc b·∫±ng <a>)
    movieCard.innerHTML = `
      <a href="${watchUrl}" class="movie-link">
        <img src="${movie.thumbnail}" alt="${movie.title}" class="movie-thumbnail">
        <div class="movie-info">
          <h3 class="movie-title">${movie.title}</h3>
          <div class="movie-meta">
            <span>${actorsHTML}</span>
            <span>HD</span>
          </div>
          <div class="movie-tags">${tagsHTML}</div>
        </div>
      </a>
    `;

    // N·∫øu mu·ªën click tr√°i load trong c√πng tab
    movieCard.querySelector('a').addEventListener('click', (e) => {
      e.preventDefault();
      window.location.href = watchUrl;
    });

    moviesContainer.appendChild(movieCard);
  });
}


function openPlayer(movie) {
  if (!movie) return;

  // üõë X√≥a video c≈© ngay l·∫≠p t·ª©c ƒë·ªÉ tr√°nh ch·∫°y ng·∫ßm
  if (videoFrame) {
    videoFrame.src = ""; // g·ª° iframe ƒë·ªÉ gi·∫£i ph√≥ng b·ªô nh·ªõ
  }

  // üßπ D·ªçn danh s√°ch g·ª£i √Ω c≈©
  const relatedContainer = document.getElementById("related-videos-list");
  if (relatedContainer) {
    relatedContainer.innerHTML = "";
  }

  // Ti·∫øp t·ª•c hi·ªÉn th·ªã video m·ªõi
  if (!playerTitle || !playerDescription || !videoFrame || !sourceLink || !playerContainer) {
    console.error('Some required elements are missing in the DOM.');
    return;
  }

  playerTitle.textContent = movie.title;

  // Th·ªùi l∆∞·ª£ng v√† nƒÉm ph√°t h√†nh
  const playerDuration = document.getElementById("player-duration");
  const playerRelease = document.getElementById("player-release");

  if (playerDuration && movie.duration && movie.duration.includes(':')) {
    const parts = movie.duration.split(':');
    const h = parseInt(parts[0]) || 0;
    const m = parseInt(parts[1]) || 0;
    const s = parseInt(parts[2]) || 0;
    const totalMinutes = h * 60 + m + (s >= 30 ? 1 : 0);
    playerDuration.textContent = `${totalMinutes} ph√∫t`;
  }

  if (playerRelease && typeof movie.release === 'string') {
    const year = movie.release.split('-')[0];
    playerRelease.textContent = year || 'N/A';
  }

  let infoHTML = '';
  if (movie.code) infoHTML += `<div><strong>M√£ phim:</strong> ${movie.code}</div>`;
  if (movie.release) infoHTML += `<div><strong>Ng√†y ph√°t h√†nh:</strong> ${movie.release}</div>`;
  if (movie.duration) infoHTML += `<div><strong>Th·ªùi l∆∞·ª£ng:</strong> ${movie.duration}</div>`;

  if (movie.series) {
    infoHTML += `<div><strong>Series:</strong> <span class="clickable-meta" style="cursor:pointer;color:#007bff;">${movie.series}</span></div>`;
  }

  if (movie.maker) {
    infoHTML += `<div><strong>Nh√† s·∫£n xu·∫•t:</strong> <span class="clickable-meta" style="cursor:pointer;color:#007bff;">${movie.maker}</span></div>`;
  }

  if (movie.label) {
    infoHTML += `<div><strong>Nh√£n hi·ªáu:</strong> <span class="clickable-meta" style="cursor:pointer;color:#007bff;">${movie.label}</span></div>`;
  }

  if (movie.description) {
    infoHTML += `<div><strong>M√¥ t·∫£:</strong> <span style="color:#fff;">${movie.description}</span></div>`;
  }

  if (movie.actors?.length) {
    const actorsHTML = movie.actors.map(actor => 
      `<span class="clickable-actor" style="cursor:pointer;color:#007bff;">${actor}</span>`
    ).join(', ');
    infoHTML += `<div><strong>T√°c gi·∫£:</strong> ${actorsHTML}</div>`;
  }

  if (movie.tags?.length) {
    const tagsHTML = movie.tags.map(tag =>
      `<span class="clickable-tag" style="cursor:pointer;color:#007bff;">${tag}</span>`
    ).join(', ');
    infoHTML += `<div><strong>M√£:</strong> ${tagsHTML}</div>`;
  }

  if (movie.genres?.length) {
    const genresHTML = movie.genres.map(genre =>
      `<span class="clickable-genre" style="cursor:pointer;color:#007bff;">${genre}</span>`
    ).join(', ');
    infoHTML += `<div><strong>Th·ªÉ lo·∫°i:</strong> ${genresHTML}</div>`;
  }

  playerDescription.innerHTML = infoHTML;

  playerDescription.querySelectorAll('.clickable-actor, .clickable-meta, .clickable-tag, .clickable-genre').forEach(span => {
    span.addEventListener('click', () => {
      handleTagOrActorClick(span.textContent);
    });
  });

  // üéØ G√°n video m·ªõi
  videoFrame.src = movie.iframe_src || '';
  sourceLink.href = movie.url || '#';

  // üîÑ G·ª£i √Ω m·ªõi
  showRelatedVideos(movie);

  playerContainer.style.display = 'block';
  document.body.style.overflow = 'hidden';

  setTimeout(() => {
    playerContainer.scrollTo({ top: 0, behavior: 'smooth' });
  }, 100);

  try {
    const data = JSON.parse(localStorage.getItem('watchProgress') || '{}');
    data[movie.title] = 0;
    localStorage.setItem('watchProgress', JSON.stringify(data));
  } catch (e) {
    console.error("L·ªói khi l∆∞u ti·∫øn ƒë·ªô xem:", e);
  }
}



function closeVideoPlayer() {
  playerContainer.style.display = 'none';
  videoFrame.src = '';
  document.body.style.overflow = 'auto';
}

function showRelatedVideos(currentMovie, previousRelated = []) {
  const relatedContainer = document.getElementById("related-videos-list");
  relatedContainer.innerHTML = "";

  const prevTitles = new Set((previousRelated || []).map(v => v.title));
  const currentTitle = currentMovie.title;

  // ‚è±Ô∏è L·ªçc video ƒë√£ click trong v√≤ng 10 ph√∫t
  const clickedData = JSON.parse(localStorage.getItem("clickedVideos") || "{}");
  const now = Date.now();
  const CLICK_TIMEOUT = 10 * 60 * 1000; // 10 ph√∫t
  const clickedTitles = new Set();

  for (const [title, time] of Object.entries(clickedData)) {
    if (now - time < CLICK_TIMEOUT) {
      clickedTitles.add(title);
    }
  }

  // G·ª£i √Ω theo tag
  const relatedByTags = videos.filter(v =>
    v.title !== currentTitle &&
    !prevTitles.has(v.title) &&
    !clickedTitles.has(v.title) &&
    Array.isArray(v.tags) &&
    v.tags.some(tag => (currentMovie.tags || []).includes(tag))
  );

  // G·ª£i √Ω theo di·ªÖn vi√™n
  const relatedByActors = videos.filter(v =>
    v.title !== currentTitle &&
    !prevTitles.has(v.title) &&
    !clickedTitles.has(v.title) &&
    Array.isArray(v.actors) &&
    v.actors.some(actor => (currentMovie.actors || []).includes(actor))
  );

  // G·ªôp & lo·∫°i b·ªè tr√πng
  const seen = new Set();
  const relatedVideos = [...relatedByTags, ...relatedByActors].filter(v => {
    if (seen.has(v.title)) return false;
    seen.add(v.title);
    return true;
  });

  // Ng·∫´u nhi√™n
  const excludeTitles = new Set([...relatedVideos.map(v => v.title), currentTitle, ...prevTitles, ...clickedTitles]);
  const randomVideos = videos.filter(v => !excludeTitles.has(v.title));
  shuffleArray(randomVideos);

  const finalList = [...randomVideos.slice(0, 3), ...relatedVideos];

  const finalSeen = new Set(finalList.map(v => v.title));
  const extra = videos.filter(v => !finalSeen.has(v.title) && v.title !== currentTitle);
  shuffleArray(extra);
  while (finalList.length < 24 && extra.length > 0) {
    finalList.push(extra.pop());
  }

  if (finalList.length === 0) {
    relatedContainer.innerHTML = "<p>Kh√¥ng c√≥ video g·ª£i √Ω.</p>";
    return;
  }

  // Hi·ªÉn th·ªã theo nh√≥m
  const groupSize = 10;
  let currentIndex = 0;

  // üëâ Wrapper n√∫t "Xem th√™m"
  const buttonWrapper = document.createElement("div");
  buttonWrapper.className = "see-more-button-wrapper";

  const seeMoreBtn = document.createElement("button");
  seeMoreBtn.textContent = "Xem th√™m";
  seeMoreBtn.className = "see-more-button";
  seeMoreBtn.addEventListener("click", renderGroup);

  buttonWrapper.appendChild(seeMoreBtn);
  relatedContainer.appendChild(buttonWrapper);

  function renderGroup() {
    const nextGroup = finalList.slice(currentIndex, currentIndex + groupSize);
    nextGroup.forEach(video => {
      const div = document.createElement("div");
      div.className = "related-video-item";
      div.innerHTML = `
        <img src="${video.thumbnail}" alt="${video.title}" style="width: 100%; border-radius: 8px;" />
        <p class="video-title" title="${video.title}">${video.title}</p>
      `;
      div.addEventListener("click", (e) => {
        e.preventDefault();
        markVideoAsClicked(video.title); // ‚úÖ L∆∞u click v√†o localStorage
        openPlayer(video);
      });
      relatedContainer.insertBefore(div, buttonWrapper); // ‚úÖ ch√®n TR∆Ø·ªöC n√∫t
    });

    currentIndex += groupSize;
    if (currentIndex >= finalList.length) {
      seeMoreBtn.style.display = "none";
    }
  }

  renderGroup(); // Nh√≥m ƒë·∫ßu
  currentMovie.relatedShown = finalList;
}

// ‚úÖ Ghi nh·∫≠n video ƒë√£ click v·ªõi timestamp
function markVideoAsClicked(title) {
  const data = JSON.parse(localStorage.getItem("clickedVideos") || "{}");
  const now = Date.now();
  data[title] = now;
  localStorage.setItem("clickedVideos", JSON.stringify(data));
}

// üîÅ Tr·ªôn m·∫£ng
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function closeVideoPlayer() {
  playerContainer.style.display = 'none';
  videoFrame.src = '';
  document.body.style.overflow = 'auto';
}

function handleTagOrActorClick(keyword) {
  searchInput.value = keyword;
  doSearch(keyword);
  closeVideoPlayer();
  scrollToTop();
}

function filterVideos(query) {
  const lowerQuery = query.toLowerCase().trim();
  const onlyOneActor = document.getElementById('onlyOneActor')?.checked;

  return (videos || []).filter(movie => {
    const actors = movie.actors || [];
    const tags = movie.genres || []; // genres l√† tag

    // Actor ch√≠nh x√°c
    const isActorMatched = actors.some(actor => actor.toLowerCase() === lowerQuery);

    // Title g·∫ßn ƒë√∫ng (kh√¥ng t√°ch t·ª´, match c·∫£ chu·ªói)
    const isTitleMatched = (movie.title || '').toLowerCase().includes(lowerQuery);

    // Tag (genres) g·∫ßn ƒë√∫ng (v·∫´n t√°ch t·ª´ n·∫øu mu·ªën)
    const isTagMatched = tags.some(tag => tag.toLowerCase().includes(lowerQuery));

    // C√°c field kh√°c g·∫ßn ƒë√∫ng
    const isOtherFieldMatched =
      (movie.series || '').toLowerCase().includes(lowerQuery) ||
      (movie.maker || '').toLowerCase().includes(lowerQuery) ||
      (movie.label || '').toLowerCase().includes(lowerQuery);

    // N·∫øu b·∫≠t "ch·ªâ 1 di·ªÖn vi√™n"
    if (onlyOneActor && isActorMatched) {
      return actors.length === 1 && actors[0].toLowerCase() === lowerQuery;
    }

    return isActorMatched || isTitleMatched || isTagMatched || isOtherFieldMatched;
  });
}

document.getElementById('onlyOneActor').addEventListener('change', () => {
  doSearch(searchInput.value.trim());
});

// === T√¨m ki·∫øm ch√≠nh ===
// --- H√†m chu·∫©n h√≥a chu·ªói ---
function normalizeStr(str) {
  return String(str || "")
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '-')      // kho·∫£ng tr·∫Øng ‚Üí d·∫•u -
    .replace(/‚Äì|‚Äî/g, '-')      // d·∫•u d√†i ‚Üí d·∫•u -
    .normalize('NFC');          // chu·∫©n h√≥a Unicode
}

// --- H√†m t√¨m ki·∫øm ---
function doSearch(query, skipPush = false) {
  const lowerQuery = normalizeStr(query);
  if (!query.trim()) lowerQuery = '';

  // N·∫øu query l√† "l1" th√¨ hi·ªán popup video ƒë√£ xem
  if (lowerQuery === 'l1') {
    showWatchedVideosPopup();
    return;
  }

  // N·∫øu query r·ªóng ‚Üí reset
  if (!query.trim()) {
    currentFiltered = [...videos].reverse();
    currentPage = 1;

    if (!skipPush) {
      history.pushState({ page: 1 }, '', '?page=1');
      localStorage.setItem('lastPage', 1);
    }

    renderMoviesPage(currentPage, currentFiltered);

    document.getElementById('search-result-box').style.display = 'none';
    document.getElementById('actor-info-box').style.display = 'none';
    document.getElementById('actor-filter-box').style.display = 'none';
    document.getElementById('onlyOneActor').checked = false;
    return;
  }

  // --- Chia query th√†nh c√°c t·ª´ ƒë·ªÉ t√¨m g·∫ßn ƒë√∫ng ---
  const queryWords = lowerQuery.split(/[\s\-]+/); // t√°ch theo kho·∫£ng tr·∫Øng ho·∫∑c d·∫•u -

  // --- L·ªçc video ---
  const filtered = videos.filter(video => {
    const titleNorm = normalizeStr(video.title);
    const actorsNorm = (video.actors || []).map(normalizeStr);
    const tagsNorm = (video.tags || []).map(normalizeStr);

    // Ki·ªÉm tra t·∫•t c·∫£ t·ª´ trong query c√≥ xu·∫•t hi·ªán √≠t nh·∫•t trong title, actor, ho·∫∑c tag
    return queryWords.every(word =>
      titleNorm.includes(word) ||
      actorsNorm.some(a => a.includes(word)) ||
      tagsNorm.some(t => t.includes(word))
    );
  });

  currentFiltered = [...filtered].reverse();
  currentPage = 1;

  // Update URL
  if (!skipPush) {
    const newURL = `?search=${encodeURIComponent(query)}&page=1`;
    history.pushState({ page: 1, search: query }, '', newURL);
    localStorage.setItem('lastPage', 1);
  }

  // Render
  renderMoviesPage(currentPage, currentFiltered);

  // --- T√¨m actor ch√≠nh x√°c ---
  const actorInfoBox = document.getElementById('actor-info-box');
  const avatar = document.getElementById('actor-avatar');
  const name = document.getElementById('actor-name');
  const count = document.getElementById('actor-count');
  const resultBox = document.getElementById('search-result-box');
  const resultText = document.getElementById('search-result-text');

  const matchedActorVideos = (videos || []).filter(video =>
    (video.actors || []).some(actor => normalizeStr(actor) === lowerQuery)
  );

  if (matchedActorVideos.length > 0) {
  const exactActor = matchedActorVideos[0].actors.find(
    actor => normalizeStr(actor) === lowerQuery
  );

  avatar.src = "https://cdn2.fptshop.com.vn/small/avatar_trang_1_cd729c335b.jpg";
  name.textContent = exactActor;
  count.textContent = `${matchedActorVideos.length} video`;

  actorInfoBox.style.display = 'flex';
  document.getElementById('actor-filter-box').style.display = 'block';
  resultBox.style.display = 'none';
} else {
  actorInfoBox.style.display = 'none';
  document.getElementById('actor-filter-box').style.display = 'none';
  document.getElementById('onlyOneActor').checked = false;

// --- Hi·ªÉn th·ªã s·ªë video t√¨m ƒë∆∞·ª£c d∆∞·ªõi d√≤ng ch·ªØ, cƒÉn gi·ªØa v√† ch·ªØ nh·ªè ---
resultText.innerHTML = `
  K·∫øt qu·∫£ cho: ${query}<br>
  <span style="display:block; text-align:center; font-size:12px; color:#555;">${filtered.length} video</span>
`;
resultBox.style.display = 'flex';
}

}

// --- B·∫Øt s·ª± ki·ªán Back/Forward ---
window.onpopstate = function () {
  const params = new URLSearchParams(window.location.search);
  const query = params.get('search') || "";
  doSearch(query, true);
};

// --- T·ª± ƒë·ªông ch·∫°y n·∫øu URL c√≥ search ---
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const query = params.get('search') || "";
  if (query) doSearch(query, true);
});




function showWatchedVideosPopup() {
  const data = JSON.parse(localStorage.getItem('watchProgress') || '{}');
  const watchedList = Object.entries(data);

  if (watchedList.length === 0) {
    alert("Ch∆∞a c√≥ video n√†o ƒë∆∞·ª£c xem.");
    return;
  }

  // Xo√° popup c≈© n·∫øu c√≥
  document.getElementById('watched-popup-wrapper')?.remove();
  document.getElementById('watched-close-btn')?.remove();

  // T·∫°o khung ch·ª©a popup
  const wrapper = document.createElement('div');
  wrapper.id = 'watched-popup-wrapper';
  wrapper.style.position = 'fixed';
  wrapper.style.top = '0';
  wrapper.style.left = '0';
  wrapper.style.width = '100vw';
  wrapper.style.height = '100vh';
  wrapper.style.backgroundColor = 'rgba(0,0,0,0.4)';
  wrapper.style.display = 'flex';
  wrapper.style.alignItems = 'center';
  wrapper.style.justifyContent = 'center';
  wrapper.style.zIndex = '9999';

  // T·∫°o popup
  const popup = document.createElement('div');
  popup.id = 'watched-popup';
  popup.style.background = '#fff';
  popup.style.border = '2px solid #444';
  popup.style.padding = '20px';
  popup.style.maxHeight = '80vh';
  popup.style.overflowY = 'auto';
  popup.style.borderRadius = '10px';
  popup.style.boxShadow = '0 0 15px rgba(0,0,0,0.3)';
  popup.style.width = '90%';
  popup.style.maxWidth = '700px';
  popup.style.color = '#000';
  popup.style.position = 'relative';

  popup.innerHTML = `
    <h3 style="margin-bottom: 10px;">üì∫ L·ªãch s·ª≠ ƒë√£ xem</h3>
    <div id="watched-list"></div>
  `;

  wrapper.appendChild(popup);
  document.body.appendChild(wrapper);

  // T·∫°o n√∫t ƒë√≥ng X
  setTimeout(() => {
    const rect = popup.getBoundingClientRect();
    const closeBtn = document.createElement('button');
    closeBtn.id = 'watched-close-btn';
    closeBtn.textContent = '‚úñ';
    closeBtn.style.position = 'fixed';
    closeBtn.style.top = `${rect.top - 10}px`;
    closeBtn.style.left = `${rect.right - 25}px`;
    closeBtn.style.background = '#e50914';
    closeBtn.style.color = '#fff';
    closeBtn.style.border = 'none';
    closeBtn.style.fontSize = '18px';
    closeBtn.style.cursor = 'pointer';
    closeBtn.style.padding = '5px 10px';
    closeBtn.style.borderRadius = '50%';
    closeBtn.style.zIndex = '10000';

    closeBtn.onclick = () => {
      wrapper.remove();
      closeBtn.remove();
    };

    document.body.appendChild(closeBtn);
  }, 0);

  // Hi·ªÉn th·ªã danh s√°ch video
  const listContainer = document.getElementById('watched-list');
  listContainer.innerHTML = '';

  // ‚ùóÔ∏è Hi·ªÉn th·ªã m·ªõi nh·∫•t l√™n ƒë·∫ßu
  watchedList.reverse().forEach(([title, seconds]) => {
    const index = videos.findIndex(v => v.title === title);
    if (index === -1) return;
    const video = videos[index];

    const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
    const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
    const time = `${mins}:${secs}`;
    const thumb = video.thumbnail || 'https://via.placeholder.com/400x250?text=No+Image';

    const div = document.createElement('div');
    div.className = 'watched-item';
    div.style.display = 'flex';
    div.style.alignItems = 'center';
    div.style.marginBottom = '12px';
    div.style.borderBottom = '1px solid #ccc';
    div.style.paddingBottom = '10px';
    div.style.cursor = 'pointer';
    div.setAttribute('data-index', index);

    div.innerHTML = `
      <img src="${thumb}" alt="thumb" style="width: 400px; height: 250px; object-fit: cover; margin-right: 10px; border-radius: 6px;">
      <div style="flex:1;">
        <div style="font-weight:bold; font-size:18px; color:#e50914;">üé¨ ${video.code || 'Kh√¥ng r√µ m√£'}</div>
        <div style="color:#555;">‚è± ƒê√£ xem: ${time}</div>
      </div>
    `;

    listContainer.appendChild(div);
  });

  // X·ª≠ l√Ω click m·ªü video
  document.querySelectorAll('.watched-item').forEach(el => {
    el.addEventListener('click', () => {
      const index = parseInt(el.getAttribute('data-index'));
      const video = videos[index];
      if (video) {
        openPlayer(video); // m·ªü video
        wrapper.remove(); // ƒë√≥ng popup
        document.getElementById('watched-close-btn')?.remove(); // xo√° n√∫t ‚úñ
      }
    });
  });
}



const videoElement = document.getElementById('main-video');
if (videoElement) {
  videoElement.addEventListener('timeupdate', () => {
    const currentTitle = playerTitle?.textContent;
    if (currentTitle) {
      const progress = Math.floor(videoElement.currentTime);
      const data = JSON.parse(localStorage.getItem('watchProgress') || '{}');
      data[currentTitle] = progress;
      localStorage.setItem('watchProgress', JSON.stringify(data));
    }
  });
}



// -------------------------- S·ª∞ KI·ªÜN --------------------------



function buildPageLink(page) {
  const params = new URLSearchParams(window.location.search);
  params.set("page", page);
  return location.pathname + "?" + params.toString();
}

function updateURL(page) {
  const params = new URLSearchParams(window.location.search);
  params.set("page", page);
  history.pushState({ page }, "", location.pathname + "?" + params.toString());
}

function goToPage(page) {
  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  if (page < 1) page = 1;
  if (page > totalPages) page = totalPages;

  // Gi·ªØ nguy√™n search param
  const params = new URLSearchParams(window.location.search);
  params.set("page", page);

  const newUrl = window.location.pathname + "?" + params.toString();
  history.pushState({ page }, "", newUrl);

  currentPage = page;
  localStorage.setItem("lastPage", page);

  renderMoviesPage(currentPage, currentFiltered);
  renderPagination(currentPage, totalPages);
  updateControls();
}

function formatNumber(num) {
  return num.toLocaleString("en-US"); // hi·ªÉn th·ªã d·∫°ng 1,000
}

function renderPagination(current, total) {
  let html = `<ul>`;

  if (current > 1) {
    html += `<li><a href="${buildPageLink(current - 1)}" class="prev-page">Tr∆∞·ªõc</a></li>`;
  }

  if (current > 3) {
    html += `<li><a href="${buildPageLink(1)}" class="first-page">${formatNumber(1)}</a></li>`;
    if (current > 4) {
      html += `<li><span class="ellipsis">...</span></li>`;
    }
  }

  for (let i = current - 6; i <= current + 6; i++) {
    if (i > 0 && i <= total) {
      if (i === current) {
        html += `<li><a class="active" href="${buildPageLink(i)}">${formatNumber(i)}</a></li>`;
      } else {
        html += `<li><a href="${buildPageLink(i)}">${formatNumber(i)}</a></li>`;
      }
    }
  }

  if (current < total - 2) {
    if (current < total - 3) {
      html += `<li><span class="ellipsis">...</span></li>`;
    }
    html += `<li><a href="${buildPageLink(total)}" class="last-page">${formatNumber(total)}</a></li>`;
  }

  if (current < total) {
    html += `<li><a href="${buildPageLink(current + 1)}" class="next-page">Ti·∫øp</a></li>`;
  }

  html += `</ul>`;
  document.getElementById("pagination").innerHTML = `<div class="pagination">${html}</div>`;

  // G·∫Øn event ƒë·ªÉ ch·∫∑n reload
  document.querySelectorAll("#pagination a").forEach(a => {
    a.addEventListener("click", e => {
      e.preventDefault();
      const url = new URL(a.href);
      const page = parseInt(url.searchParams.get("page")) || 1;
      goToPage(page);
    });
  });
}

function updateControls() {
  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  document.getElementById("pageInput").value = currentPage;
  document.getElementById("pageInput").max = totalPages;
  document.getElementById("totalPages").textContent = "/ " + totalPages;
}

// Khi load trang
window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  let pageFromURL = parseInt(params.get("page"));
  if (!pageFromURL) {
    pageFromURL = parseInt(localStorage.getItem("lastPage")) || 1;
  }
  currentPage = pageFromURL;

  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  renderMoviesPage(currentPage, currentFiltered);
  renderPagination(currentPage, totalPages);
  updateControls();
});

// L·∫Øng nghe Back/Forward
window.addEventListener("popstate", (event) => {
  const params = new URLSearchParams(window.location.search);
  let pageFromURL = parseInt(params.get("page")) || 1;
  currentPage = pageFromURL;
  renderMoviesPage(currentPage, currentFiltered);
  renderPagination(currentPage, Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1);
  updateControls();
});

// N√∫t Prev
document.getElementById("prevPageBtn").addEventListener("click", () => {
  if (currentPage > 1) goToPage(currentPage - 1);
});

// N√∫t Next
document.getElementById("nextPageBtn").addEventListener("click", () => {
  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  if (currentPage < totalPages) goToPage(currentPage + 1);
});

// √î nh·∫≠p s·ªë + Enter
document.getElementById("pageInput").addEventListener("keydown", e => {
  if (e.key === "Enter") {
    const page = parseInt(e.target.value) || 1;
    goToPage(page);
  }
});


function bindSearchEnter() {
  const searchInput = document.getElementById('search-input');
  if (!searchInput) return;

  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const query = searchInput.value.trim();
      suggestionsBox.style.display = 'none';
      if (query) {
        doSearch(query);
      } else {
        currentFiltered = [...videos].reverse();
        goToPage(1);
      }
    }
  });
}

// G·ªçi khi load trang
window.addEventListener('DOMContentLoaded', bindSearchEnter);

// --- G·ªçi khi load trang ---
window.addEventListener('DOMContentLoaded', () => {
  bindSearchEnter(); // G·∫Øn s·ª± ki·ªán Enter cho √¥ search khi load
});

// --- H√†m reset trang v·ªÅ m·∫∑c ƒë·ªãnh ---
function resetHomePage() {
  // 1. Reset URL v·ªÅ g·ªëc (x√≥a query string)
  history.replaceState({}, "", location.pathname);

  // 2. X√≥a √¥ t√¨m ki·∫øm
  const searchInput = document.getElementById('search-input');
  if (searchInput) searchInput.value = '';

  // 3. Reset danh s√°ch video v·ªÅ tr·∫°ng th√°i m·∫∑c ƒë·ªãnh (m·ªõi nh·∫•t l√™n ƒë·∫ßu)
  currentFiltered = [...videos].reverse();

  // 4. G·ªçi ph√¢n trang chu·∫©n v·ªÅ trang 1 (c·∫≠p nh·∫≠t URL + l∆∞u lastPage)
  goToPage(1);

  // 5. ·∫®n c√°c h·ªôp li√™n quan
  const boxesToHide = ['year-filter-box', 'actor-info-box', 'actor-filter-box', 'search-result-box'];
  boxesToHide.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  // 6. B·ªè check l·ªçc "ch·ªâ 1 di·ªÖn vi√™n"
  const onlyOneActor = document.getElementById('onlyOneActor');
  if (onlyOneActor) onlyOneActor.checked = false;

  // 7. T·∫Øt player video n·∫øu ƒëang m·ªü
  const player = document.getElementById('playerContainer');
  if (player) {
    player.style.display = 'none';
    const videoFrame = document.getElementById('videoFrame');
    if (videoFrame) videoFrame.src = '';
    document.body.style.overflow = 'auto';
  }

  // 8. Cu·ªôn v·ªÅ ƒë·∫ßu trang
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // 9. G·∫Øn l·∫°i s·ª± ki·ªán Enter cho search n·∫øu c·∫ßn
  bindSearchEnter();
}

// --- G·∫Øn s·ª± ki·ªán click cho logo ---
const logo = document.getElementById('logo');
if (logo) {
  logo.addEventListener('click', e => {
    e.preventDefault();
    resetHomePage();
  });
}

// --- Ph√≠m t·∫Øt ph√¢n trang ---
document.addEventListener('keydown', e => {
  const tag = document.activeElement.tagName.toLowerCase();
  if (tag === 'input' || tag === 'textarea') return;

  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE);

  if (e.key === 'ArrowLeft' && currentPage > 1) {
    goToPage(currentPage - 1); // d√πng h√†m c√≥ update URL + l∆∞u
  }

  if (e.key === 'ArrowRight' && currentPage < totalPages) {
    goToPage(currentPage + 1); // d√πng h√†m c√≥ update URL + l∆∞u
  }
});

// --- ƒê√≥ng player video ---
if (closePlayer) closePlayer.addEventListener('click', closeVideoPlayer);


// -------------------------- G·ª¢I √ù DI·ªÑN VI√äN V√Ä TAG--------------------------

searchInput.addEventListener('input', e => {
  const query = e.target.value.trim().toLowerCase();
  if (!query) {
    suggestionsBox.style.display = 'none';
    return;
  }

  // ƒê·∫øm actor
  const actorCounts = {};
  videos.forEach(video => {
    (video.actors || []).forEach(actor => {
      if (actor.toLowerCase().includes(query)) {
        actorCounts[actor] = (actorCounts[actor] || 0) + 1;
      }
    });
  });
  const matchedActors = Object.entries(actorCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  // ƒê·∫øm tags (m√£ code nh∆∞ HUNTB, etc.)
  const tagCounts = {};
  videos.forEach(video => {
    (video.tags || []).forEach(tag => {
      if (tag.toLowerCase().includes(query)) {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
      }
    });
  });
  const matchedTags = Object.entries(tagCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  // ƒê·∫øm genres (th·ªÉ lo·∫°i)
  const genreCounts = {};
  videos.forEach(video => {
    (video.genres || []).forEach(genre => {
      if (genre.toLowerCase().includes(query)) {
        genreCounts[genre] = (genreCounts[genre] || 0) + 1;
      }
    });
  });
  const matchedGenres = Object.entries(genreCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  if (
    matchedActors.length === 0 &&
    matchedTags.length === 0 &&
    matchedGenres.length === 0
  ) {
    suggestionsBox.style.display = 'none';
    return;
  }

  suggestionsBox.innerHTML = '';

  // --- G·ª¢I √ù ACTOR ---
  if (matchedActors.length > 0) {
    const actorHeader = document.createElement('div');
    actorHeader.textContent = 'T√°c gi·∫£:';
    actorHeader.style.fontWeight = 'bold';
    actorHeader.style.padding = '4px 8px';
    actorHeader.style.color = 'black';
    suggestionsBox.appendChild(actorHeader);

    matchedActors.forEach(([actor]) => {
      const item = document.createElement('div');
      item.innerHTML = `üé≠ ${actor}`;
      item.style.padding = '6px 8px';
      item.style.cursor = 'pointer';
      item.style.color = 'black';
      item.addEventListener('mousedown', () => {
        searchInput.value = actor;
        doSearch(actor);
        suggestionsBox.style.display = 'none';
      });
      suggestionsBox.appendChild(item);
    });
  }

// --- G·ª¢I √ù CODE (tags) ---
if (matchedTags.length > 0) {
  const tagHeader = document.createElement('div');
  tagHeader.textContent = 'Code:';
  tagHeader.style.fontWeight = 'bold';
  tagHeader.style.padding = '4px 8px';
  tagHeader.style.color = 'black';
  suggestionsBox.appendChild(tagHeader);

  matchedTags.forEach(([tag, count]) => {
    const item = document.createElement('div');
    item.innerHTML = `üé¨ ${tag} | ${count} video`;  // ‚úÖ gi·ªØ l·∫°i d·∫°ng n√†y
    item.style.padding = '6px 8px';
    item.style.cursor = 'pointer';
    item.style.color = 'black';
    item.addEventListener('mousedown', () => {
      searchInput.value = tag;
      doSearch(tag);
      suggestionsBox.style.display = 'none';
    });
    suggestionsBox.appendChild(item);
  });
}

// --- G·ª¢I √ù TH·ªÇ LO·∫†I (genres) ---
if (matchedGenres.length > 0) {
  const genreHeader = document.createElement('div');
  genreHeader.textContent = 'Th·ªÉ lo·∫°i:';
  genreHeader.style.fontWeight = 'bold';
  genreHeader.style.padding = '4px 8px';
  genreHeader.style.color = 'black';
  suggestionsBox.appendChild(genreHeader);

  matchedGenres.forEach(([genre, count]) => {  // üëà c·∫≠p nh·∫≠t th√†nh tuple [genre, count]
    const item = document.createElement('div');
    item.innerHTML = `üé¨ ${genre} | ${count} video`;  // ‚úÖ th√™m count gi·ªëng nh∆∞ tag
    item.style.padding = '6px 8px';
    item.style.cursor = 'pointer';
    item.style.color = 'black';
    item.addEventListener('mousedown', () => {
      searchInput.value = genre;
      doSearch(genre);
      suggestionsBox.style.display = 'none';
    });
    suggestionsBox.appendChild(item);
  });
}

  // --- HI·ªÇN H·ªòP G·ª¢I √ù ---
const rect = searchInput.getBoundingClientRect();
const scrollTop  = window.pageYOffset || document.documentElement.scrollTop;
const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

suggestionsBox.style.position = 'absolute';
suggestionsBox.style.top = rect.bottom + scrollTop + 'px';
suggestionsBox.style.left = rect.left + scrollLeft + 'px';
suggestionsBox.style.width = rect.width + 'px';
suggestionsBox.style.background = '#fff';
suggestionsBox.style.border = '1px solid #ccc';
suggestionsBox.style.zIndex = 1000;
suggestionsBox.style.display = 'block';

});

// -------------------------- L1--------------------------
document.getElementById("quick-search-btn").addEventListener("click", () => {
  const input = document.getElementById("search-input");
  const current = input.value.trim().toLowerCase();

  if (current === "l1") {
    // N·∫øu ƒë√£ l√† "l1", x√≥a input v√† g·ª≠i Enter (t√¨m r·ªóng)
    input.value = "";
    input.dispatchEvent(new KeyboardEvent("keydown", { key: "Enter" }));
  } else {
    // N·∫øu ch∆∞a, th√¨ g√°n "l1" v√† t√¨m ki·∫øm
    input.value = "l1";
    input.dispatchEvent(new KeyboardEvent("keydown", { key: "Enter" }));
  }
});

// ------------------ N√öT L·ªäCH -------------
document.addEventListener('DOMContentLoaded', () => {
  const filterBtn = document.getElementById('year-filter-btn');
  const filterBox = document.getElementById('year-filter-box');
  const closeBtn = document.getElementById('close-filter-box');

  filterBtn.addEventListener('click', () => {
    filterBox.style.display = 'block'; // Hi·ªÉn th·ªã box
  });

  closeBtn.addEventListener('click', () => {
    filterBox.style.display = 'none'; // ƒê√≥ng box
  });

  // Ngo√†i ra, n·∫øu mu·ªën click ra ngo√†i th√¨ ƒë√≥ng box
  document.addEventListener('click', (e) => {
    if (!filterBox.contains(e.target) && !filterBtn.contains(e.target)) {
      filterBox.style.display = 'none';
    }
  });
});


// ------------------ ·∫®N LOGO KHI CU·ªòN TRONG ƒêT -------------

document.addEventListener('DOMContentLoaded', function () {
  const logo = document.getElementById('logo');

  function handleScroll() {
    const isMobile = window.innerWidth <= 600;
    if (!isMobile || !logo) return;

    const currentScroll = window.scrollY || document.documentElement.scrollTop;

    if (currentScroll > 10) {
      logo.classList.add('hidden'); // ‚úÖ ·∫®n ho√†n to√†n
    } else {
      logo.classList.remove('hidden'); // ‚úÖ Hi·ªán l·∫°i
    }
  }

  window.addEventListener('scroll', handleScroll);
  window.addEventListener('resize', handleScroll);
  handleScroll(); // ch·∫°y ban ƒë·∫ßu
});

// ------------------ N√öT HOME TR·ªû V·ªÄ TRANG TR·ª¶ -------------
document.getElementById('home-btn').addEventListener('click', e => {
  e.preventDefault();

  // 1. X√≥a √¥ t√¨m ki·∫øm
  const searchInput = document.getElementById('search-input');
  if (searchInput) searchInput.value = '';

  // 2. Reset danh s√°ch video v·ªÅ tr·∫°ng th√°i m·∫∑c ƒë·ªãnh
  currentFiltered = [...videos].reverse(); // M·ªõi nh·∫•t l√™n ƒë·∫ßu
  currentPage = 1;
  renderMoviesPage(currentPage, currentFiltered);

  // 3. ·∫®n c√°c h·ªôp li√™n quan
  const yearBox = document.getElementById('year-filter-box');
  if (yearBox) yearBox.style.display = 'none';

  const actorInfoBox = document.getElementById('actor-info-box');
  if (actorInfoBox) actorInfoBox.style.display = 'none';

  const actorFilterBox = document.getElementById('actor-filter-box');
  if (actorFilterBox) actorFilterBox.style.display = 'none';

  const resultBox = document.getElementById('search-result-box');
  if (resultBox) resultBox.style.display = 'none';

  // 4. B·ªè check l·ªçc "ch·ªâ 1 di·ªÖn vi√™n"
  const onlyOneActor = document.getElementById('onlyOneActor');
  if (onlyOneActor) onlyOneActor.checked = false;

  // 5. T·∫Øt player video n·∫øu ƒëang m·ªü
  const player = document.getElementById('playerContainer');
  if (player) {
    player.style.display = 'none';
    const videoFrame = document.getElementById('videoFrame');
    if (videoFrame) videoFrame.src = '';
    document.body.style.overflow = 'auto';
  }

  // 6. Cu·ªôn v·ªÅ ƒë·∫ßu trang
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// ------------------ G·ª¢I √ù D√çNH V√ÄO THANH T√åM KI·∫æM -------------
function updateSuggestionBoxPosition() {
  const rect = searchInput.getBoundingClientRect();
  const scrollTop  = window.pageYOffset || document.documentElement.scrollTop;
  const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

  suggestionsBox.style.position = 'absolute';
  suggestionsBox.style.top = rect.bottom + scrollTop + 'px';
  suggestionsBox.style.left = rect.left + scrollLeft + 'px';
  suggestionsBox.style.width = rect.width + 'px';
}
searchInput.addEventListener('input', e => {
  // (ph·∫ßn g·ª£i √Ω nh∆∞ b·∫°n ƒë√£ c√≥...)
  updateSuggestionBoxPosition(); // ‚úÖ G·ªçi m·ªói khi g√µ
});

window.addEventListener('scroll', updateSuggestionBoxPosition);
window.addEventListener('resize', updateSuggestionBoxPosition);

document.addEventListener('DOMContentLoaded', () => {
  updateSuggestionBoxPosition(); // ƒê·∫£m b·∫£o ƒë√∫ng v·ªã tr√≠ ngay khi load
});

// ------------------ ·∫®N DANH S√ÅCH T·ªîNG CU·ªêI TRANG -------------

document.getElementById('totalPages').style.display = 'none';

// ------------------ POPUP T·∫†M BI·ªÜT -------------

function nextPopupPage() {
  if (document.getElementById('popup-page-1').style.display === 'block') {
    document.getElementById('popup-page-1').style.display = 'none';
    document.getElementById('popup-page-2').style.display = 'block';
  } else if (document.getElementById('popup-page-2').style.display === 'block') {
    document.getElementById('popup-page-2').style.display = 'none';
    document.getElementById('popup-page-3').style.display = 'block';
  }
}

function prevPopupPage() {
  if (document.getElementById('popup-page-3').style.display === 'block') {
    document.getElementById('popup-page-3').style.display = 'none';
    document.getElementById('popup-page-2').style.display = 'block';
  } else if (document.getElementById('popup-page-2').style.display === 'block') {
    document.getElementById('popup-page-2').style.display = 'none';
    document.getElementById('popup-page-1').style.display = 'block';
  }
}

function closeWelcomePopup() {
  document.getElementById('popup-welcome').style.display = 'none';
}

window.onload = function () {
  document.getElementById('popup-welcome').style.display = 'flex';
  document.getElementById('popup-page-1').style.display = 'block';
  document.getElementById('popup-page-2').style.display = 'none';
  document.getElementById('popup-page-3').style.display = 'none';
};



// -------------------------- KH·ªûI ƒê·ªòNG --------------------------

loadCurrentPage();
renderMoviesPage(currentPage, currentFiltered);


document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('search-input');

  // G·∫Øn s·ª± ki·ªán Enter cho search
  if (searchInput) {
    searchInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        const query = searchInput.value.trim();
        suggestionsBox.style.display = 'none';
        if (query) {
          doSearch(query);
        } else {
          currentFiltered = [...videos].reverse();
          goToPage(1);
        }
      }
    });
  }

  // L·∫•y page v√† search t·ª´ URL
  const params = new URLSearchParams(window.location.search);
  const pageFromURL = parseInt(params.get('page')) || 1;
  const keyword = params.get('search');

  if (!currentFiltered || currentFiltered.length === 0) {
    currentFiltered = [...videos].reverse();
  }

  if (keyword && searchInput) {
    searchInput.value = keyword;
    doSearch(keyword); // G·ªçi tr·ª±c ti·∫øp t√¨m ki·∫øm
  } else {
    renderMoviesPage(pageFromURL, currentFiltered);
  }

  currentPage = pageFromURL;
});

  const updateBtn = document.getElementById('update-btn');
  const updateBox = document.getElementById('update-box');
  const closeUpdateBox = document.getElementById('close-update-box');

  updateBtn.addEventListener('click', () => updateBox.style.display = 'block');
  closeUpdateBox.addEventListener('click', () => updateBox.style.display = 'none');

  // Click ngo√†i popup ƒë√≥ng
  window.addEventListener('click', (e) => {
    if(e.target === updateBox) updateBox.style.display = 'none';
  });
    </script>
</body>

</html>
