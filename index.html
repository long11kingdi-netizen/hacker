<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Streaming Website</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #e50914;
            --dark: #141414;
            --gray: #808080;
            --light-gray: #e5e5e5;
            --white: #ffffff;
        }

        body {
            background-color: #0c0c0c;
            color: var(--white);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background: linear-gradient(to bottom, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
        }

        .logo span {
            color: var(--white);
        }

        .search-container {
            display: flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            padding: 8px 15px;
            width: 300px;
        }

        .search-container input {
            background: transparent;
            border: none;
            color: var(--white);
            width: 100%;
            font-size: 16px;
            padding: 5px;
        }

        .search-container input:focus {
            outline: none;
        }

        .search-container i {
            color: var(--gray);
            margin-right: 10px;
        }

        /* Main Content Styles */
        .main-content {
            padding: 30px 0;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
        }

.movies-grid {
    display: grid;
    grid-template-columns: repeat(5, 350px); /* 5 cột 350px */
    justify-content: center;
    gap: 25px;
    margin-bottom: 40px;
}

.movie-card {
    background: #1a1a1a;
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    cursor: pointer;
    position: relative;
    width: 350px;  /* phù hợp với grid */
    margin: 0 auto;
}

.movie-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
}

.movie-thumbnail {
    width: 350px;      /* bằng với card */
    height: 250px;
    object-fit: cover;
    display: block;
    margin: 0 auto;
}


        .movie-info {
            padding: 15px;
        }

.movie-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    line-height: 1.4;
    max-height: calc(1.4em * 2);     /* ✅ 2 dòng */
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 2;
    overflow: hidden;
    text-overflow: ellipsis;
}



        .movie-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 14px;
        }
        
.movie-meta span:first-child {
    display: -webkit-box;
    -webkit-line-clamp: 2;               /* ✅ Tối đa 2 dòng */
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: calc(1.4em * 2);         /* ✅ Chiều cao tương ứng */
    line-height: 1.4;
}
        .movie-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 10px;
        }

        .tag {
            background: rgba(229, 9, 20, 0.2);
            color: #ff5c66;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        /* Video Player Styles */
/* Ẩn phần nội dung chính khi player mở */
body.player-open #mainContent {
    display: none !important;
}

/* Player container */
.video-player-container {
    display: none;
    position: fixed;
    inset: 0;
    background: #000; /* Đổi từ rgba -> đen hẳn để không bị "mờ mờ" */
    z-index: 1000;
    overflow-y: auto;
    animation: fadeIn 0.3s ease;
    padding: 30px 0;
}

/* Animation hiển thị player */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Header của player */
.player-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-bottom: 15px;
    border-bottom: 1px solid #333;
}

/* Nút đóng player */
.close-player {
    background: transparent;
    border: none;
    font-size: 26px;
    color: #ccc;
    cursor: pointer;
    transition: color 0.2s;
}

.close-player:hover {
    color: var(--primary);
}

/* Video khung ngoài */
.video-frame-wrapper {
    position: relative;
    padding-top: 56.25%;
    margin-top: 20px;
    background: #000;
    border-radius: 8px;
    overflow: hidden;
}

/* Video iframe */
.video-frame {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* Tiêu đề video */
.player-title {
    font-size: 28px;
    font-weight: bold;
    margin: 25px 0 15px;
    color: var(--white);
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

/* Thông tin mô tả */
.player-meta {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
    flex-wrap: wrap;
    color: var(--light-gray);
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

/* Phần mô tả chính */
.player-description {
    background: #1a1a1a;
    padding: 20px 25px;
    border-radius: 8px;
    margin-top: 20px;
    box-shadow: 0 0 10px rgba(255,255,255,0.05);
}

.description-title {
    font-size: 20px;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 10px;
}

#player-description {
    color: var(--light-gray);
    line-height: 1.6;
}

/* Tag và thể loại */
.tags-container,
.genres-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 15px 0;
}

.player-tag,
.player-genre {
    background: rgba(255, 255, 255, 0.1);
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 14px;
    color: #ff5c66;
    white-space: nowrap;
}

/* Nút xem */
.watch-button {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: var(--primary);
    color: var(--white);
    padding: 12px 24px;
    font-weight: bold;
    border-radius: 6px;
    text-decoration: none;
    margin-top: 15px;
    transition: background 0.3s ease;
}

.watch-button:hover {
    background: #f40612;
}

        /* Footer Styles */
        footer {
            background: #000;
            padding: 40px 0 20px;
            margin-top: 50px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
        }

        .footer-section {
            flex: 1;
            min-width: 200px;
        }

        .footer-title {
            font-size: 18px;
            margin-bottom: 20px;
            color: var(--white);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: var(--gray);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            color: var(--gray);
            font-size: 14px;
            border-top: 1px solid #333;
            margin-top: 30px;
        }

        /* Responsive Design */
       @media (max-width: 768px) {
    .header-container {
        flex-direction: column;
        gap: 15px;
    }


    .search-container {
        width: 100%;
    }

  .pagination ul {
    flex-wrap: wrap;       /* Cho phép xuống dòng */
    justify-content: center;
    gap: 4px;
  }

  .pagination li a {
    padding: 6px 10px;
    font-size: 14px;
    flex: 0 1 auto;        /* Cho phép co lại */
    min-width: 36px;       /* vẫn đủ chạm tay */
  }

.movies-grid {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px;
}

    .movie-thumbnail {
        width: 100%;
        height: 250px; /* ✅ Mobile: 200px */
        object-fit: cover;
    }

    .video-frame {
        height: 50vh;
    }

    .player-title {
        font-size: 18px;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        max-height: calc(1.4em * 3);
    }
      #popup-page-3 .code-grid > div {
    flex: 1 0 45%;
  }

  #popup-page-3 b {
    font-size: 15px;
    padding: 5px 10px;
  }

  #popup-welcome-content {
    padding: 20px;
  }

  #popup-welcome-content h3 {
    font-size: 20px;
  }
}


        /* Phần chuyển trang */
.pagination-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin: 30px 0;
}

#prevPageBtn,
#nextPageBtn {
  background-color: #333;
  color: #fff;
  border: none;
  font-size: 18px;
  padding: 8px 14px;
  border-radius: 6px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#prevPageBtn:hover,
#nextPageBtn:hover {
  background-color: #555;
}

#pageInput {
  width: 60px;
  padding: 6px 10px;
  font-size: 16px;
  border-radius: 4px;
  border: 1px solid #666;
  background-color: #1a1a1a;
  color: #fff;
  text-align: center;
}

#totalPages {
  display: none;
}
.video-player-container {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 1000;
  overflow-y: auto;
  animation: fadeIn 0.3s ease;
  padding: 30px 0;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.player-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-bottom: 15px;
  border-bottom: 1px solid #333;
}

.video-frame-wrapper {
  position: relative;
  padding-top: 56.25%;
  margin-top: 20px;
  background: #000;
  border-radius: 8px;
  overflow: hidden;
}

.video-frame {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

.player-title {
  font-size: 28px;
  font-weight: bold;
  margin-top: 25px;
  margin-bottom: 15px;
  color: var(--white);
}

.player-meta {
  display: flex;
  gap: 20px;
  margin-bottom: 15px;
  flex-wrap: wrap;
  color: var(--light-gray);
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
}

.player-description {
  background: #1a1a1a;
  padding: 20px 25px;
  border-radius: 8px;
  margin-top: 20px;
  box-shadow: 0 0 10px rgba(255,255,255,0.05);
}

.description-title {
  font-size: 20px;
  font-weight: 600;
  color: var(--primary);
  margin-bottom: 10px;
}

#player-description {
  color: var(--light-gray);
  line-height: 1.6;
}

.tags-container, .genres-container {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin: 15px 0;
}

.player-tag,
.player-genre {
  background: rgba(255, 255, 255, 0.1);
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 14px;
  color: #ff5c66;
  white-space: nowrap;
}

.watch-button {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: var(--primary);
  color: var(--white);
  padding: 12px 24px;
  font-weight: bold;
  border-radius: 6px;
  text-decoration: none;
  margin-top: 15px;
  transition: background 0.3s ease;
}

.watch-button:hover {
  background: #f40612;
}

.close-player {
  background: transparent;
  border: none;
  font-size: 26px;
  color: #ccc;
  cursor: pointer;
  transition: color 0.2s;
}

.close-player:hover {
  color: var(--primary);
}

#year-filter-box {
  display: none;
  position: absolute;
  background: #ffffff;
  border: 1px solid #ccc;
  padding: 12px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  border-radius: 8px;
  top: 100%;
  right: 10px;                 /* ✅ Căn góc phải */
  width: max-content;
  max-width: 90vw;            /* ✅ Không vượt quá màn hình */
}


#year-filter-box select {
  margin: 5px;
  padding: 5px;
  font-size: 14px;
  border-radius: 4px;
  border: 1px solid #aaa;
}

#year-filter-box button {
  margin-top: 8px;
  padding: 6px 12px;
  font-size: 14px;
  cursor: pointer;
  background-color: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  transition: background-color 0.3s ease;
}

#year-filter-box button:hover {
  background-color: #0056b3;
}

#close-filter-box {
  background-color: transparent;
  border: none;
  font-size: 16px;
  float: right;
  color: #888;
  cursor: pointer;
}

#close-filter-box:hover {
  color: red;
}

/* ✅ Responsive hỗ trợ điện thoại */
@media (max-width: 600px) {
  #year-filter-box {
    left: 50% !important;
    right: auto !important;
    transform: translateX(-50%);
    width: 90vw;
    max-width: 90vw;
    box-sizing: border-box;
  }

  #year-filter-box select,
  #year-filter-box button {
    width: 100%;
    margin: 6px 0;
    font-size: 16px;
  }
  /* container vẫn flex, xuống dòng nếu cần */
  #movies-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: space-between;
  }

  /* card mobile 2 cột */
  .movie-card {
    flex: 0 0 calc(50% - 4px); /* 2 cột, trừ gap */
    max-width: calc(50% - 4px);
    box-sizing: border-box;
  }

  /* hình thumbnail mobile */
  .movie-thumbnail {
    width: 100%;
    height: auto;
    aspect-ratio: 16/9;
    border-radius: 8px;
    display: block;
  }
  #close-filter-box {
    float: none;
    text-align: right;
    display: block;
    width: 100%;
  }
#watched-close-btn {
  position: absolute;
  top: -12px; /* nằm gần đỉnh popup */
  right: -12px; /* nằm gần góc phải của popup */
  z-index: 10001;
  color: #fff;
  border: none;
  font-size: 18px;
  padding: 6px 10px;
  border-radius: 50%;
  cursor: pointer;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
}

#watched-close-btn:hover {
  background-color: #d9363e;
}

  #logo {
    transition: opacity 0.3s ease, visibility 0.3s ease;
    opacity: 1;
    visibility: visible;
    height: auto;
  }

  #logo.hidden {
    opacity: 0;
    visibility: hidden;
    height: 0;
    overflow: hidden;
  }
}



#actor-filter-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;  /* Căn giữa theo chiều ngang */
  margin-top: 10px;
}

#actor-filter-box {
  display: none; /* Ẩn mặc định, chỉ hiển thị khi tìm đúng actor */
}

.actor-checkbox {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-size: 14px;
  color: #333;
  background: #f9f9f9;
  padding: 8px 14px;
  border-radius: 8px;
  border: 1px solid #ccc;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.actor-checkbox input[type="checkbox"] {
  accent-color: #007bff;
  transform: scale(1.2);
  cursor: pointer;
}

#actor-info-wrapper {
  width: 100%;
  display: flex;
  justify-content: center;
  margin-top: 12px;
}

#actor-info-box {
  display: none;
  align-items: center;
  gap: 12px;
  background: #f2f2f2;
  border: 1px solid #ccc;
  border-radius: 10px;
  padding: 10px 16px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

#actor-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #007bff;
}

.actor-info-text {
  display: flex;
  flex-direction: column;
  font-size: 14px;
  color: #333;
}

#actor-name {
  font-weight: bold;
  color: #000;
}

#actor-count {
  font-size: 13px;
  color: #666;
}

#search-result-box {
  width: 100%;
  display: flex;
  justify-content: center;
  margin: 10px 0;
  font-size: 15px;
  color: #333;
}

#search-result-text {
  background: #eaf4ff;
  padding: 6px 12px;
  border-radius: 6px;
  border: 1px solid #bcd;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}


.related-videos-list {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}


.related-video-item {
  width: calc(20% - 8px); /* 100% / 5 video - khoảng gap */
  cursor: pointer;
  box-sizing: border-box;
}



.video-title {
  font-size: 14px;
  font-weight: bold;
  margin-top: 4px;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
  line-height: 1.4em;
  height: calc(1.4em * 3); /* Đảm bảo chiều cao đúng 3 dòng */
}




.see-more-button-wrapper {
  display: flex;
  justify-content: center;
  width: 100%;
  margin-top: 24px;
}

.see-more-button {
  padding: 12px 30px;
  background: linear-gradient(135deg, #ff3366, #ff6699);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition: transform 0.2s ease, box-shadow 0.3s ease, background 0.4s ease;
  box-shadow: 0 4px 12px rgba(255, 51, 102, 0.4);
}

.see-more-button::before {
  content: "";
  position: absolute;
  top: 0;
  left: -75%;
  width: 50%;
  height: 100%;
  background: rgba(255, 255, 255, 0.3);
  transform: skewX(-20deg);
  transition: left 0.4s ease;
}

.see-more-button:hover::before {
  left: 125%;
}

.see-more-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(255, 51, 102, 0.6);
  background: linear-gradient(135deg, #ff0033, #ff66a3);
}

.see-more-button:active {
  transform: scale(0.96);
  box-shadow: 0 3px 10px rgba(255, 51, 102, 0.5);
}

#suggestions-box div {
  font-size: 14px;
  border-bottom: 1px solid #eee;
}

#popup-welcome {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(30, 30, 30, 0.6);
  backdrop-filter: blur(6px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  animation: fadeIn 0.5s ease-out;
}

#popup-welcome-content {
  background: white;
  color: #222;
  padding: 30px;
  border-radius: 12px;
  max-width: 500px;
  width: 90%;
  text-align: left;
  font-family: 'Segoe UI', sans-serif;
  box-shadow: 0 15px 30px rgba(0,0,0,0.3);
  animation: popupZoom 0.4s ease-out;
}

#popup-welcome-content h3 {
  font-size: 22px;
  margin-bottom: 15px;
}

#popup-welcome-content p {
  margin-bottom: 10px;
  line-height: 1.6;
}

#popup-welcome-content button {
  margin: 10px 5px 0 0;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  background-color: #007BFF;
  color: white;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

#popup-welcome-content button:hover {
  background-color: #0056b3;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes popupZoom {
  0% { transform: scale(0.9); opacity: 0; }
  100% { transform: scale(1); opacity: 1; }
}

/* Popup Page 3: Video hay của năm */
#popup-page-3 b {
  display: inline-block;
  padding: 6px 12px;
  background-color: #f0f0f0;
  border-radius: 6px;
  text-align: center;
  width: 100%;
  transition: background-color 0.2s;
  cursor: pointer;
  margin-bottom: 8px;
  font-size: 16px;
}

#popup-page-3 b:hover {
  background-color: #ddd;
  color: #000;
}

/* Layout dòng 3 ô */
#popup-page-3 .code-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
}

#popup-page-3 .code-grid > div {
  flex: 1 0 30%;
  min-width: 80px;
}

#related-videos-list img {

  height: 150px;
  object-fit: cover; /* Giữ ảnh không bị méo nhưng sẽ crop */
}

/* --- Pagination list --- */
.pagination ul {
  display: flex;
  gap: 6px;
  list-style: none;
  padding: 0;
  margin: 16px 0;
  justify-content: center;
}

.pagination li a {
  display: inline-block;
  padding: 6px 12px;
  border-radius: 6px;
  text-decoration: none;
  background: #555;      /* nền xám */
  color: #fff;           /* chữ trắng */
  font-size: 14px;
  transition: background 0.2s;
}

.pagination li a:hover {
  background: #777;      /* xám sáng hơn khi hover */
}

.pagination li a.active {
  background: #007bff;   /* xanh dương cho trang hiện tại */
  color: #fff;
  font-weight: bold;
}

/* --- Pagination controls --- */
.pagination-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 10px;
  font-size: 14px;
}

.pagination-controls button {
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  background: #555;   /* nền xám */
  color: #fff;        /* chữ trắng */
  cursor: pointer;
  transition: background 0.2s;
}

.pagination-controls button:hover {
  background: #777;
}

.pagination-controls input {
  width: 50px;
  text-align: center;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

.pagination-controls {
  display: none !important;
}

.movie-link {
  text-decoration: none;   /* bỏ gạch dưới */
  color: inherit;          /* giữ nguyên màu chữ */
  display: block;          /* để bao toàn bộ card */
}
.movie-link:hover {
  text-decoration: none;   /* khi hover cũng không gạch */
}
  #actor-filter-wrapper {
    position: absolute;
    width: 0;
    height: 0;
    overflow: hidden;
  }

    /* Ẩn nút nhưng vẫn giữ trong DOM */
  #home-btn,
  #quick-search-btn {
    position: absolute;   /* giữ vị trí */
    width: 1px;           /* giảm kích thước */
    height: 1px;
    overflow: hidden;
    border: none;
    padding: 0;
    margin: 0;
    clip: rect(0,0,0,0);  /* ẩn hoàn toàn */
  }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <a href="#" id="logo" class="logo">MOVIE<span>STREAM</span></a>

            <div class="search-container">
                <i class="fas fa-search"></i>
                <input type="text" id="search-input" placeholder="Tìm kiếm phim...">
<!-- Nút cập nhật -->
<button id="update-btn" title="Thông tin cập nhật">🔔</button>

<!-- Popup cập nhật -->
<div id="update-box" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; border:1px solid #ccc; padding:20px; z-index:1000; color:#000; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.2); max-width:400px; width:90%; max-height:80vh; overflow:auto;">

  <div style="display:flex; align-items:center; margin-bottom:10px;">
    <strong style="font-size:20px; color:#d9534f; flex-grow:1;">BẢN UPDATE 0.2</strong>
    <button id="close-update-box" style="font-size:18px; background:transparent; border:none; color:#888; cursor:pointer; margin-left:10px;">❌</button>
  </div>

  <hr style="margin:8px 0;">

  <div id="update-content" style="font-size:14px; line-height:1.6; color:#333;">
    <div style="margin-bottom:10px;">
      <strong>Tính năng mới:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>Hỗ trợ tìm kiếm video, diễn viên, tiêu đề</li>
        <li>Gợi ý video một cách thông minh hơn</li>
        <li>Nút hỗ trợ khi gặp lỗi [⚠️]</li>
        <li>Thông báo đang tải trang khi xem video</li>
        <li>Giao diện người dùng thân thiện hơn</li>
        <li>Nút dịch tiêu đề trong trang xem</li>
      </ul>
    </div>
    <div style="margin-bottom:10px;">
      <strong>Lỗi đã sửa:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>Video không xem được</li>
        <li>Không hiện các video gợi ý</li>
        <li>Không sử dụng được thanh tìm kiếm</li>
      </ul>
    </div>
    <div style="margin-bottom:10px;">
      <strong>Server:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>Tăng tốc độ truy cập nhanh hơn lúc trước 5 lần</li>
        <li>Tối ưu hóa server</li>
        <li>Giảm thiểu quá tải dữ liệu</li>
        <li>Không trùng lặp video, chỉ có 1 video duy nhất</li>
      </ul>
    </div>
    <div style="margin-bottom:10px;">
      <strong>Lỗi đang sửa:</strong>
      <ul style="padding-left:20px; margin:4px 0;">
        <li>Không thể về trang trước</li>
        <li>Server tự động sập</li>
      </ul>
      <!-- Chữ nhỏ mờ mờ -->
      <div style="font-size:12px; color:#888; margin-top:4px;">
        - - - Đang tìm nguyên nhân dẫn đến lỗi - - -
      </div>
    </div>
  </div>
</div>

<!-- Nút HOME thay cho logo -->
<button id="home-btn" title="Trang chủ">🏠</button>

      <!-- ✅ Nút tìm kiếm nhanh L1 -->
      <button id="quick-search-btn">🕘</button>

<!-- Thay nút 📅 bằng nút ⚠️ -->
<button id="year-filter-btn" title="Các lỗi thường gặp">⚠️</button>

<!-- Popup vẫn dùng year-filter-box -->
<div id="year-filter-box" style="display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:#fff; border:1px solid #ccc; padding:20px; z-index:1000; color:#000; border-radius:10px; box-shadow:0 8px 20px rgba(0,0,0,0.2); max-width:400px; width:90%; max-height:80vh; overflow:auto;">

  <!-- Header popup -->
  <div style="display:flex; align-items:center; margin-bottom:10px;">
    <strong style="color:#000; font-size:16px; display:flex; align-items:center; white-space:nowrap; flex-grow:1;">
      ⚠️ <span style="margin-left:5px;">CÁC LỖI THƯỜNG GẶP</span>
    </strong>
    <button id="close-filter-box" style="font-size:18px; background:transparent; border:none; color:#888; cursor:pointer; margin-left:10px;">❌</button>
  </div>

  <hr style="margin:8px 0;">

<!-- Nội dung popup -->
<div id="main-content" style="font-size:14px; line-height:1.5; color:#333;">
  <ul style="padding-left:20px; margin:0;">
    <li>
      <strong>Lỗi Video mờ:</strong> Do server video đang tự động tối ưu, nên video ban đầu có thể bị mờ.  
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Giải pháp: Mở (phóng to) video, sau đó đợi một lúc hoặc tua sang vài cảnh thì video sẽ rõ nét trở lại.
      </div>
    </li>
    <li>
      <strong>Lỗi Video:</strong> Video giật, lag hoặc không load được do server quá tải.  
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Giải pháp: tải lại trang hoặc báo với admin
      </div>
    </li>
    <li>
      <strong>Lỗi Trang:</strong> Trang lỗi hoặc không tải được trang do hỏng hoặc xung đột server.  
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Giải pháp: tải lại trang hoặc báo với admin
      </div>
    </li>
    <li>
      <strong>Lỗi tìm kiếm:</strong> Tìm kiếm đúng video nhưng trang tìm kiếm không hiện do admin chưa cập nhật đầy đủ. 
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Giải pháp: Báo ngay với admin ❗
      </div>
    </li>
    <li>
      <strong>Link web không load:</strong> Khi trở về trang trước mà link thay đổi rồi , nhưng web vẫn ở trang lúc trước . Do 1 số lỗi với server
      <div style="margin-top:4px; font-weight:bold; color:#d9534f; background:#fff3f3; padding:4px 6px; border-radius:4px; display:inline-block;">
        Giải pháp: Báo ngay với admin ngay lập tức ❗
      </div>
    </li>
  </ul>
</div>
</div>




  <div id="main-content">
  <!-- Nội dung sẽ được thay thế bằng kết quả tìm kiếm -->
</div>


            </div>
        </div>
    </header>

    <!-- Hiển thị thông tin diễn viên khi tìm đúng -->
<div id="actor-info-wrapper">
  <div id="actor-info-box">
    <img id="actor-avatar" src="" alt="Avatar" />
    <div class="actor-info-text">
      <div id="actor-name"></div>
      <div id="actor-count"></div>
    </div>
  </div>
</div>

<div id="actor-filter-wrapper">
  <div id="actor-filter-box">
    <label class="actor-checkbox">
      <input type="checkbox" id="onlyOneActor" />
      Chỉ hiện video có đúng 1 tác giả chính
    </label>
  </div>
</div>

<div id="search-result-box" style="display: none;">
  <span id="search-result-text"></span>
</div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <h2 class="section-title">Phim Đề Xuất</h2>
            <div class="movies-grid" id="movies-container">
                <!-- Movie cards will be generated here by JavaScript -->
            </div>
            
        </div>
    </main>

<!-- Video Player -->
<div class="video-player-container" id="player-container" style="display: none;">
  <div class="container">
    <div class="player-header">
      <a href="#" id="logo" class="logo">MOVIE<span>STREAM</span></a>
      <button class="close-player" id="close-player" title="Đóng">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="video-details">
      <h2 class="player-title" id="player-title"></h2>

      <div class="video-frame-wrapper">
        <iframe class="video-frame" id="video-frame" allowfullscreen></iframe>
      </div>

      <div class="player-meta">
        <div class="meta-item">
          <i class="fas fa-star"></i>
          <span id="player-rating">?/10</span>
        </div>
        <div class="meta-item">
          <i class="fas fa-clock"></i>
          <span id="player-duration">? phút</span>
        </div>
        <div class="meta-item">
          <i class="fas fa-calendar"></i>
          <span id="player-release">20??</span>
        </div>
      </div>

      <div class="player-description">
        <h3 class="description-title">Thông tin phim</h3>
        <div id="player-description"></div>

        <div class="tags-container" id="player-tags"></div>
        <div class="genres-container" id="player-genres"></div>

<a href="#" class="watch-button" id="source-link" target="_blank"
   style="opacity: 0; pointer-events: auto; position: absolute; z-index: -1;">
  Xem
</a>


        <div class="related-videos" id="related-videos">
  <h3>Gợi ý khác</h3>
  <div class="related-videos-list" id="related-videos-list"></div>
</div>

      </div>
    </div>
  </div>
</div>



<div id="pagination"></div>

<div class="pagination-controls">
  <button id="prevPageBtn">◀</button>
  <input type="number" id="pageInput" value="1" min="1" />
  <button id="nextPageBtn">▶</button>
  <span id="totalPages">/ 1</span>
</div>

    <!-- Footer -->
    <footer>
        <div class="container">

            <div class="copyright">
                &copy; 2025 MovieStream
            </div>
        </div>

<script src="cosplay.js"></script>
<script src="bigass.js"></script>
<script src="blowjob.js"></script>
<script src="bigtits.js"></script>
<script src="คลิปหลุดไทย.js"></script>
<script src="คาชุดนักศึกษา.js"></script>
<script src="thai.js"></script>

<!-- Sau đó là đoạn xử lý chính -->
<script>
  const videos = [ ...thai,]; // 👈 đúng thứ tự mong muốn
  const ITEMS_PER_PAGE = 25;
  let currentPage = 1;
  let currentFiltered = [...videos].reverse(); // ✅ đảo ngược để mới lên đầu

const moviesContainer = document.getElementById('movies-container');
const playerContainer = document.getElementById('player-container');
const videoFrame = document.getElementById('video-frame');
const playerTitle = document.getElementById('player-title');
const playerDescription = document.getElementById('player-description');
const playerTags = document.getElementById('player-tags');
const playerGenres = document.getElementById('player-genres');
const sourceLink = document.getElementById('source-link');
const closePlayer = document.getElementById('close-player');
const searchInput = document.getElementById('search-input');
const pageInput = document.getElementById('pageInput');
const totalPagesEl = document.getElementById('totalPages');
const prevPageBtn = document.getElementById('prevPageBtn');
const nextPageBtn = document.getElementById('nextPageBtn');
const suggestionsBox = document.createElement('div');

// Gợi ý actor khi gõ
suggestionsBox.id = 'suggestions-box';
suggestionsBox.style.position = 'absolute';
suggestionsBox.style.background = '#fff';
suggestionsBox.style.border = '1px solid #ccc';
suggestionsBox.style.maxHeight = '200px';
suggestionsBox.style.overflowY = 'auto';
suggestionsBox.style.zIndex = 9999;
suggestionsBox.style.display = 'none';
document.body.appendChild(suggestionsBox);

// -------------------------- HÀM CHÍNH --------------------------

function saveCurrentPage() {
  localStorage.setItem('currentVideoPage', currentPage);
}

function loadCurrentPage() {
  const saved = parseInt(localStorage.getItem('currentVideoPage'));
  if (!isNaN(saved)) currentPage = saved;
}

function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function renderMoviesPage(page, list) {
  // Sắp xếp list theo ngày giảm dần (mới nhất lên đầu)
  list.sort((a, b) => new Date(b.date) - new Date(a.date));

  const totalPages = Math.ceil(list.length / ITEMS_PER_PAGE);
  if (page < 1) page = 1;
  if (page > totalPages) page = totalPages;

  const start = (page - 1) * ITEMS_PER_PAGE;
  const end = start + ITEMS_PER_PAGE;
  const slice = list.slice(start, end);

  renderMovies(slice);
  pageInput.value = page;
  totalPagesEl.textContent = `/ ${totalPages}`;
  saveCurrentPage();
  scrollToTop();
}


function renderMovies(movies) {
  moviesContainer.innerHTML = '';

  movies.forEach((movie) => {
    const movieCard = document.createElement('div');
    movieCard.className = 'movie-card';

    const videoId = encodeURIComponent(movie.id || movie.code || movie.title);
    const watchUrl = `watch.html?v=${videoId}`;

    // Actors
    const actorsHTML = (movie.actors || [])
      .map(actor => `<span style="cursor: pointer;" data-actor="${actor}">${actor}</span>`)
      .join(', ');

    // Tags
    const tagsHTML = (movie.tags || [])
      .map(tag => `<span class="tag" data-tag="${tag}">${tag}</span>`)
      .join('');

    // Card HTML (bọc bằng <a>)
    movieCard.innerHTML = `
      <a href="${watchUrl}" class="movie-link">
        <img src="${movie.thumbnail}" alt="${movie.title}" class="movie-thumbnail">
        <div class="movie-info">
          <h3 class="movie-title">${movie.title}</h3>
          <div class="movie-meta">
            <span>${actorsHTML}</span>
            <span>HD</span>
          </div>
          <div class="movie-tags">${tagsHTML}</div>
        </div>
      </a>
    `;

    // Nếu muốn click trái load trong cùng tab
    movieCard.querySelector('a').addEventListener('click', (e) => {
      e.preventDefault();
      window.location.href = watchUrl;
    });

    moviesContainer.appendChild(movieCard);
  });
}


function openPlayer(movie) {
  if (!movie) return;

  // 🛑 Xóa video cũ ngay lập tức để tránh chạy ngầm
  if (videoFrame) {
    videoFrame.src = ""; // gỡ iframe để giải phóng bộ nhớ
  }

  // 🧹 Dọn danh sách gợi ý cũ
  const relatedContainer = document.getElementById("related-videos-list");
  if (relatedContainer) {
    relatedContainer.innerHTML = "";
  }

  // Tiếp tục hiển thị video mới
  if (!playerTitle || !playerDescription || !videoFrame || !sourceLink || !playerContainer) {
    console.error('Some required elements are missing in the DOM.');
    return;
  }

  playerTitle.textContent = movie.title;

  // Thời lượng và năm phát hành
  const playerDuration = document.getElementById("player-duration");
  const playerRelease = document.getElementById("player-release");

  if (playerDuration && movie.duration && movie.duration.includes(':')) {
    const parts = movie.duration.split(':');
    const h = parseInt(parts[0]) || 0;
    const m = parseInt(parts[1]) || 0;
    const s = parseInt(parts[2]) || 0;
    const totalMinutes = h * 60 + m + (s >= 30 ? 1 : 0);
    playerDuration.textContent = `${totalMinutes} phút`;
  }

  if (playerRelease && typeof movie.release === 'string') {
    const year = movie.release.split('-')[0];
    playerRelease.textContent = year || 'N/A';
  }

  let infoHTML = '';
  if (movie.code) infoHTML += `<div><strong>Mã phim:</strong> ${movie.code}</div>`;
  if (movie.release) infoHTML += `<div><strong>Ngày phát hành:</strong> ${movie.release}</div>`;
  if (movie.duration) infoHTML += `<div><strong>Thời lượng:</strong> ${movie.duration}</div>`;

  if (movie.series) {
    infoHTML += `<div><strong>Series:</strong> <span class="clickable-meta" style="cursor:pointer;color:#007bff;">${movie.series}</span></div>`;
  }

  if (movie.maker) {
    infoHTML += `<div><strong>Nhà sản xuất:</strong> <span class="clickable-meta" style="cursor:pointer;color:#007bff;">${movie.maker}</span></div>`;
  }

  if (movie.label) {
    infoHTML += `<div><strong>Nhãn hiệu:</strong> <span class="clickable-meta" style="cursor:pointer;color:#007bff;">${movie.label}</span></div>`;
  }

  if (movie.description) {
    infoHTML += `<div><strong>Mô tả:</strong> <span style="color:#fff;">${movie.description}</span></div>`;
  }

  if (movie.actors?.length) {
    const actorsHTML = movie.actors.map(actor => 
      `<span class="clickable-actor" style="cursor:pointer;color:#007bff;">${actor}</span>`
    ).join(', ');
    infoHTML += `<div><strong>Tác giả:</strong> ${actorsHTML}</div>`;
  }

  if (movie.tags?.length) {
    const tagsHTML = movie.tags.map(tag =>
      `<span class="clickable-tag" style="cursor:pointer;color:#007bff;">${tag}</span>`
    ).join(', ');
    infoHTML += `<div><strong>Mã:</strong> ${tagsHTML}</div>`;
  }

  if (movie.genres?.length) {
    const genresHTML = movie.genres.map(genre =>
      `<span class="clickable-genre" style="cursor:pointer;color:#007bff;">${genre}</span>`
    ).join(', ');
    infoHTML += `<div><strong>Thể loại:</strong> ${genresHTML}</div>`;
  }

  playerDescription.innerHTML = infoHTML;

  playerDescription.querySelectorAll('.clickable-actor, .clickable-meta, .clickable-tag, .clickable-genre').forEach(span => {
    span.addEventListener('click', () => {
      handleTagOrActorClick(span.textContent);
    });
  });

  // 🎯 Gán video mới
  videoFrame.src = movie.iframe_src || '';
  sourceLink.href = movie.url || '#';

  // 🔄 Gợi ý mới
  showRelatedVideos(movie);

  playerContainer.style.display = 'block';
  document.body.style.overflow = 'hidden';

  setTimeout(() => {
    playerContainer.scrollTo({ top: 0, behavior: 'smooth' });
  }, 100);

  try {
    const data = JSON.parse(localStorage.getItem('watchProgress') || '{}');
    data[movie.title] = 0;
    localStorage.setItem('watchProgress', JSON.stringify(data));
  } catch (e) {
    console.error("Lỗi khi lưu tiến độ xem:", e);
  }
}



function closeVideoPlayer() {
  playerContainer.style.display = 'none';
  videoFrame.src = '';
  document.body.style.overflow = 'auto';
}

function showRelatedVideos(currentMovie, previousRelated = []) {
  const relatedContainer = document.getElementById("related-videos-list");
  relatedContainer.innerHTML = "";

  const prevTitles = new Set((previousRelated || []).map(v => v.title));
  const currentTitle = currentMovie.title;

  // ⏱️ Lọc video đã click trong vòng 10 phút
  const clickedData = JSON.parse(localStorage.getItem("clickedVideos") || "{}");
  const now = Date.now();
  const CLICK_TIMEOUT = 10 * 60 * 1000; // 10 phút
  const clickedTitles = new Set();

  for (const [title, time] of Object.entries(clickedData)) {
    if (now - time < CLICK_TIMEOUT) {
      clickedTitles.add(title);
    }
  }

  // Gợi ý theo tag
  const relatedByTags = videos.filter(v =>
    v.title !== currentTitle &&
    !prevTitles.has(v.title) &&
    !clickedTitles.has(v.title) &&
    Array.isArray(v.tags) &&
    v.tags.some(tag => (currentMovie.tags || []).includes(tag))
  );

  // Gợi ý theo diễn viên
  const relatedByActors = videos.filter(v =>
    v.title !== currentTitle &&
    !prevTitles.has(v.title) &&
    !clickedTitles.has(v.title) &&
    Array.isArray(v.actors) &&
    v.actors.some(actor => (currentMovie.actors || []).includes(actor))
  );

  // Gộp & loại bỏ trùng
  const seen = new Set();
  const relatedVideos = [...relatedByTags, ...relatedByActors].filter(v => {
    if (seen.has(v.title)) return false;
    seen.add(v.title);
    return true;
  });

  // Ngẫu nhiên
  const excludeTitles = new Set([...relatedVideos.map(v => v.title), currentTitle, ...prevTitles, ...clickedTitles]);
  const randomVideos = videos.filter(v => !excludeTitles.has(v.title));
  shuffleArray(randomVideos);

  const finalList = [...randomVideos.slice(0, 3), ...relatedVideos];

  const finalSeen = new Set(finalList.map(v => v.title));
  const extra = videos.filter(v => !finalSeen.has(v.title) && v.title !== currentTitle);
  shuffleArray(extra);
  while (finalList.length < 24 && extra.length > 0) {
    finalList.push(extra.pop());
  }

  if (finalList.length === 0) {
    relatedContainer.innerHTML = "<p>Không có video gợi ý.</p>";
    return;
  }

  // Hiển thị theo nhóm
  const groupSize = 10;
  let currentIndex = 0;

  // 👉 Wrapper nút "Xem thêm"
  const buttonWrapper = document.createElement("div");
  buttonWrapper.className = "see-more-button-wrapper";

  const seeMoreBtn = document.createElement("button");
  seeMoreBtn.textContent = "Xem thêm";
  seeMoreBtn.className = "see-more-button";
  seeMoreBtn.addEventListener("click", renderGroup);

  buttonWrapper.appendChild(seeMoreBtn);
  relatedContainer.appendChild(buttonWrapper);

  function renderGroup() {
    const nextGroup = finalList.slice(currentIndex, currentIndex + groupSize);
    nextGroup.forEach(video => {
      const div = document.createElement("div");
      div.className = "related-video-item";
      div.innerHTML = `
        <img src="${video.thumbnail}" alt="${video.title}" style="width: 100%; border-radius: 8px;" />
        <p class="video-title" title="${video.title}">${video.title}</p>
      `;
      div.addEventListener("click", (e) => {
        e.preventDefault();
        markVideoAsClicked(video.title); // ✅ Lưu click vào localStorage
        openPlayer(video);
      });
      relatedContainer.insertBefore(div, buttonWrapper); // ✅ chèn TRƯỚC nút
    });

    currentIndex += groupSize;
    if (currentIndex >= finalList.length) {
      seeMoreBtn.style.display = "none";
    }
  }

  renderGroup(); // Nhóm đầu
  currentMovie.relatedShown = finalList;
}

// ✅ Ghi nhận video đã click với timestamp
function markVideoAsClicked(title) {
  const data = JSON.parse(localStorage.getItem("clickedVideos") || "{}");
  const now = Date.now();
  data[title] = now;
  localStorage.setItem("clickedVideos", JSON.stringify(data));
}

// 🔁 Trộn mảng
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function closeVideoPlayer() {
  playerContainer.style.display = 'none';
  videoFrame.src = '';
  document.body.style.overflow = 'auto';
}

function handleTagOrActorClick(keyword) {
  searchInput.value = keyword;
  doSearch(keyword);
  closeVideoPlayer();
  scrollToTop();
}

function filterVideos(query) {
  const lowerQuery = query.toLowerCase().trim();
  const onlyOneActor = document.getElementById('onlyOneActor')?.checked;

  return (videos || []).filter(movie => {
    const actors = movie.actors || [];
    const tags = movie.genres || []; // genres là tag

    // Actor chính xác
    const isActorMatched = actors.some(actor => actor.toLowerCase() === lowerQuery);

    // Title gần đúng (không tách từ, match cả chuỗi)
    const isTitleMatched = (movie.title || '').toLowerCase().includes(lowerQuery);

    // Tag (genres) gần đúng (vẫn tách từ nếu muốn)
    const isTagMatched = tags.some(tag => tag.toLowerCase().includes(lowerQuery));

    // Các field khác gần đúng
    const isOtherFieldMatched =
      (movie.series || '').toLowerCase().includes(lowerQuery) ||
      (movie.maker || '').toLowerCase().includes(lowerQuery) ||
      (movie.label || '').toLowerCase().includes(lowerQuery);

    // Nếu bật "chỉ 1 diễn viên"
    if (onlyOneActor && isActorMatched) {
      return actors.length === 1 && actors[0].toLowerCase() === lowerQuery;
    }

    return isActorMatched || isTitleMatched || isTagMatched || isOtherFieldMatched;
  });
}

document.getElementById('onlyOneActor').addEventListener('change', () => {
  doSearch(searchInput.value.trim());
});

// === Tìm kiếm chính ===
// --- Hàm chuẩn hóa chuỗi ---
function normalizeStr(str) {
  return String(str || "")
    .trim()
    .toLowerCase()
    .replace(/\s+/g, '-')      // khoảng trắng → dấu -
    .replace(/–|—/g, '-')      // dấu dài → dấu -
    .normalize('NFC');          // chuẩn hóa Unicode
}

// --- Hàm tìm kiếm ---
function doSearch(query, skipPush = false) {
  const lowerQuery = normalizeStr(query);
  if (!query.trim()) lowerQuery = '';

  // Nếu query là "l1" thì hiện popup video đã xem
  if (lowerQuery === 'l1') {
    showWatchedVideosPopup();
    return;
  }

  // Nếu query rỗng → reset
  if (!query.trim()) {
    currentFiltered = [...videos].reverse();
    currentPage = 1;

    if (!skipPush) {
      history.pushState({ page: 1 }, '', '?page=1');
      localStorage.setItem('lastPage', 1);
    }

    renderMoviesPage(currentPage, currentFiltered);

    document.getElementById('search-result-box').style.display = 'none';
    document.getElementById('actor-info-box').style.display = 'none';
    document.getElementById('actor-filter-box').style.display = 'none';
    document.getElementById('onlyOneActor').checked = false;
    return;
  }

  // --- Chia query thành các từ để tìm gần đúng ---
  const queryWords = lowerQuery.split(/[\s\-]+/); // tách theo khoảng trắng hoặc dấu -

  // --- Lọc video ---
  const filtered = videos.filter(video => {
    const titleNorm = normalizeStr(video.title);
    const actorsNorm = (video.actors || []).map(normalizeStr);
    const tagsNorm = (video.tags || []).map(normalizeStr);

    // Kiểm tra tất cả từ trong query có xuất hiện ít nhất trong title, actor, hoặc tag
    return queryWords.every(word =>
      titleNorm.includes(word) ||
      actorsNorm.some(a => a.includes(word)) ||
      tagsNorm.some(t => t.includes(word))
    );
  });

  currentFiltered = [...filtered].reverse();
  currentPage = 1;

  // Update URL
  if (!skipPush) {
    const newURL = `?search=${encodeURIComponent(query)}&page=1`;
    history.pushState({ page: 1, search: query }, '', newURL);
    localStorage.setItem('lastPage', 1);
  }

  // Render
  renderMoviesPage(currentPage, currentFiltered);

  // --- Tìm actor chính xác ---
  const actorInfoBox = document.getElementById('actor-info-box');
  const avatar = document.getElementById('actor-avatar');
  const name = document.getElementById('actor-name');
  const count = document.getElementById('actor-count');
  const resultBox = document.getElementById('search-result-box');
  const resultText = document.getElementById('search-result-text');

  const matchedActorVideos = (videos || []).filter(video =>
    (video.actors || []).some(actor => normalizeStr(actor) === lowerQuery)
  );

  if (matchedActorVideos.length > 0) {
  const exactActor = matchedActorVideos[0].actors.find(
    actor => normalizeStr(actor) === lowerQuery
  );

  avatar.src = "https://cdn2.fptshop.com.vn/small/avatar_trang_1_cd729c335b.jpg";
  name.textContent = exactActor;
  count.textContent = `${matchedActorVideos.length} video`;

  actorInfoBox.style.display = 'flex';
  document.getElementById('actor-filter-box').style.display = 'block';
  resultBox.style.display = 'none';
} else {
  actorInfoBox.style.display = 'none';
  document.getElementById('actor-filter-box').style.display = 'none';
  document.getElementById('onlyOneActor').checked = false;

// --- Hiển thị số video tìm được dưới dòng chữ, căn giữa và chữ nhỏ ---
resultText.innerHTML = `
  Kết quả cho: ${query}<br>
  <span style="display:block; text-align:center; font-size:12px; color:#555;">${filtered.length} video</span>
`;
resultBox.style.display = 'flex';
}

}

// --- Bắt sự kiện Back/Forward ---
window.onpopstate = function () {
  const params = new URLSearchParams(window.location.search);
  const query = params.get('search') || "";
  doSearch(query, true);
};

// --- Tự động chạy nếu URL có search ---
document.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  const query = params.get('search') || "";
  if (query) doSearch(query, true);
});




function showWatchedVideosPopup() {
  const data = JSON.parse(localStorage.getItem('watchProgress') || '{}');
  const watchedList = Object.entries(data);

  if (watchedList.length === 0) {
    alert("Chưa có video nào được xem.");
    return;
  }

  // Xoá popup cũ nếu có
  document.getElementById('watched-popup-wrapper')?.remove();
  document.getElementById('watched-close-btn')?.remove();

  // Tạo khung chứa popup
  const wrapper = document.createElement('div');
  wrapper.id = 'watched-popup-wrapper';
  wrapper.style.position = 'fixed';
  wrapper.style.top = '0';
  wrapper.style.left = '0';
  wrapper.style.width = '100vw';
  wrapper.style.height = '100vh';
  wrapper.style.backgroundColor = 'rgba(0,0,0,0.4)';
  wrapper.style.display = 'flex';
  wrapper.style.alignItems = 'center';
  wrapper.style.justifyContent = 'center';
  wrapper.style.zIndex = '9999';

  // Tạo popup
  const popup = document.createElement('div');
  popup.id = 'watched-popup';
  popup.style.background = '#fff';
  popup.style.border = '2px solid #444';
  popup.style.padding = '20px';
  popup.style.maxHeight = '80vh';
  popup.style.overflowY = 'auto';
  popup.style.borderRadius = '10px';
  popup.style.boxShadow = '0 0 15px rgba(0,0,0,0.3)';
  popup.style.width = '90%';
  popup.style.maxWidth = '700px';
  popup.style.color = '#000';
  popup.style.position = 'relative';

  popup.innerHTML = `
    <h3 style="margin-bottom: 10px;">📺 Lịch sử đã xem</h3>
    <div id="watched-list"></div>
  `;

  wrapper.appendChild(popup);
  document.body.appendChild(wrapper);

  // Tạo nút đóng X
  setTimeout(() => {
    const rect = popup.getBoundingClientRect();
    const closeBtn = document.createElement('button');
    closeBtn.id = 'watched-close-btn';
    closeBtn.textContent = '✖';
    closeBtn.style.position = 'fixed';
    closeBtn.style.top = `${rect.top - 10}px`;
    closeBtn.style.left = `${rect.right - 25}px`;
    closeBtn.style.background = '#e50914';
    closeBtn.style.color = '#fff';
    closeBtn.style.border = 'none';
    closeBtn.style.fontSize = '18px';
    closeBtn.style.cursor = 'pointer';
    closeBtn.style.padding = '5px 10px';
    closeBtn.style.borderRadius = '50%';
    closeBtn.style.zIndex = '10000';

    closeBtn.onclick = () => {
      wrapper.remove();
      closeBtn.remove();
    };

    document.body.appendChild(closeBtn);
  }, 0);

  // Hiển thị danh sách video
  const listContainer = document.getElementById('watched-list');
  listContainer.innerHTML = '';

  // ❗️ Hiển thị mới nhất lên đầu
  watchedList.reverse().forEach(([title, seconds]) => {
    const index = videos.findIndex(v => v.title === title);
    if (index === -1) return;
    const video = videos[index];

    const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
    const secs = Math.floor(seconds % 60).toString().padStart(2, '0');
    const time = `${mins}:${secs}`;
    const thumb = video.thumbnail || 'https://via.placeholder.com/400x250?text=No+Image';

    const div = document.createElement('div');
    div.className = 'watched-item';
    div.style.display = 'flex';
    div.style.alignItems = 'center';
    div.style.marginBottom = '12px';
    div.style.borderBottom = '1px solid #ccc';
    div.style.paddingBottom = '10px';
    div.style.cursor = 'pointer';
    div.setAttribute('data-index', index);

    div.innerHTML = `
      <img src="${thumb}" alt="thumb" style="width: 400px; height: 250px; object-fit: cover; margin-right: 10px; border-radius: 6px;">
      <div style="flex:1;">
        <div style="font-weight:bold; font-size:18px; color:#e50914;">🎬 ${video.code || 'Không rõ mã'}</div>
        <div style="color:#555;">⏱ Đã xem: ${time}</div>
      </div>
    `;

    listContainer.appendChild(div);
  });

  // Xử lý click mở video
  document.querySelectorAll('.watched-item').forEach(el => {
    el.addEventListener('click', () => {
      const index = parseInt(el.getAttribute('data-index'));
      const video = videos[index];
      if (video) {
        openPlayer(video); // mở video
        wrapper.remove(); // đóng popup
        document.getElementById('watched-close-btn')?.remove(); // xoá nút ✖
      }
    });
  });
}



const videoElement = document.getElementById('main-video');
if (videoElement) {
  videoElement.addEventListener('timeupdate', () => {
    const currentTitle = playerTitle?.textContent;
    if (currentTitle) {
      const progress = Math.floor(videoElement.currentTime);
      const data = JSON.parse(localStorage.getItem('watchProgress') || '{}');
      data[currentTitle] = progress;
      localStorage.setItem('watchProgress', JSON.stringify(data));
    }
  });
}



// -------------------------- SỰ KIỆN --------------------------



function buildPageLink(page) {
  const params = new URLSearchParams(window.location.search);
  params.set("page", page);
  return location.pathname + "?" + params.toString();
}

function updateURL(page) {
  const params = new URLSearchParams(window.location.search);
  params.set("page", page);
  history.pushState({ page }, "", location.pathname + "?" + params.toString());
}

function goToPage(page) {
  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  if (page < 1) page = 1;
  if (page > totalPages) page = totalPages;

  // Giữ nguyên search param
  const params = new URLSearchParams(window.location.search);
  params.set("page", page);

  const newUrl = window.location.pathname + "?" + params.toString();
  history.pushState({ page }, "", newUrl);

  currentPage = page;
  localStorage.setItem("lastPage", page);

  renderMoviesPage(currentPage, currentFiltered);
  renderPagination(currentPage, totalPages);
  updateControls();
}

function formatNumber(num) {
  return num.toLocaleString("en-US"); // hiển thị dạng 1,000
}

function renderPagination(current, total) {
  let html = `<ul>`;

  if (current > 1) {
    html += `<li><a href="${buildPageLink(current - 1)}" class="prev-page">Trước</a></li>`;
  }

  if (current > 3) {
    html += `<li><a href="${buildPageLink(1)}" class="first-page">${formatNumber(1)}</a></li>`;
    if (current > 4) {
      html += `<li><span class="ellipsis">...</span></li>`;
    }
  }

  for (let i = current - 6; i <= current + 6; i++) {
    if (i > 0 && i <= total) {
      if (i === current) {
        html += `<li><a class="active" href="${buildPageLink(i)}">${formatNumber(i)}</a></li>`;
      } else {
        html += `<li><a href="${buildPageLink(i)}">${formatNumber(i)}</a></li>`;
      }
    }
  }

  if (current < total - 2) {
    if (current < total - 3) {
      html += `<li><span class="ellipsis">...</span></li>`;
    }
    html += `<li><a href="${buildPageLink(total)}" class="last-page">${formatNumber(total)}</a></li>`;
  }

  if (current < total) {
    html += `<li><a href="${buildPageLink(current + 1)}" class="next-page">Tiếp</a></li>`;
  }

  html += `</ul>`;
  document.getElementById("pagination").innerHTML = `<div class="pagination">${html}</div>`;

  // Gắn event để chặn reload
  document.querySelectorAll("#pagination a").forEach(a => {
    a.addEventListener("click", e => {
      e.preventDefault();
      const url = new URL(a.href);
      const page = parseInt(url.searchParams.get("page")) || 1;
      goToPage(page);
    });
  });
}

function updateControls() {
  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  document.getElementById("pageInput").value = currentPage;
  document.getElementById("pageInput").max = totalPages;
  document.getElementById("totalPages").textContent = "/ " + totalPages;
}

// Khi load trang
window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(window.location.search);
  let pageFromURL = parseInt(params.get("page"));
  if (!pageFromURL) {
    pageFromURL = parseInt(localStorage.getItem("lastPage")) || 1;
  }
  currentPage = pageFromURL;

  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  renderMoviesPage(currentPage, currentFiltered);
  renderPagination(currentPage, totalPages);
  updateControls();
});

// Lắng nghe Back/Forward
window.addEventListener("popstate", (event) => {
  const params = new URLSearchParams(window.location.search);
  let pageFromURL = parseInt(params.get("page")) || 1;
  currentPage = pageFromURL;
  renderMoviesPage(currentPage, currentFiltered);
  renderPagination(currentPage, Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1);
  updateControls();
});

// Nút Prev
document.getElementById("prevPageBtn").addEventListener("click", () => {
  if (currentPage > 1) goToPage(currentPage - 1);
});

// Nút Next
document.getElementById("nextPageBtn").addEventListener("click", () => {
  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE) || 1;
  if (currentPage < totalPages) goToPage(currentPage + 1);
});

// Ô nhập số + Enter
document.getElementById("pageInput").addEventListener("keydown", e => {
  if (e.key === "Enter") {
    const page = parseInt(e.target.value) || 1;
    goToPage(page);
  }
});


function bindSearchEnter() {
  const searchInput = document.getElementById('search-input');
  if (!searchInput) return;

  searchInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
      const query = searchInput.value.trim();
      suggestionsBox.style.display = 'none';
      if (query) {
        doSearch(query);
      } else {
        currentFiltered = [...videos].reverse();
        goToPage(1);
      }
    }
  });
}

// Gọi khi load trang
window.addEventListener('DOMContentLoaded', bindSearchEnter);

// --- Gọi khi load trang ---
window.addEventListener('DOMContentLoaded', () => {
  bindSearchEnter(); // Gắn sự kiện Enter cho ô search khi load
});

// --- Hàm reset trang về mặc định ---
function resetHomePage() {
  // 1. Reset URL về gốc (xóa query string)
  history.replaceState({}, "", location.pathname);

  // 2. Xóa ô tìm kiếm
  const searchInput = document.getElementById('search-input');
  if (searchInput) searchInput.value = '';

  // 3. Reset danh sách video về trạng thái mặc định (mới nhất lên đầu)
  currentFiltered = [...videos].reverse();

  // 4. Gọi phân trang chuẩn về trang 1 (cập nhật URL + lưu lastPage)
  goToPage(1);

  // 5. Ẩn các hộp liên quan
  const boxesToHide = ['year-filter-box', 'actor-info-box', 'actor-filter-box', 'search-result-box'];
  boxesToHide.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = 'none';
  });

  // 6. Bỏ check lọc "chỉ 1 diễn viên"
  const onlyOneActor = document.getElementById('onlyOneActor');
  if (onlyOneActor) onlyOneActor.checked = false;

  // 7. Tắt player video nếu đang mở
  const player = document.getElementById('playerContainer');
  if (player) {
    player.style.display = 'none';
    const videoFrame = document.getElementById('videoFrame');
    if (videoFrame) videoFrame.src = '';
    document.body.style.overflow = 'auto';
  }

  // 8. Cuộn về đầu trang
  window.scrollTo({ top: 0, behavior: 'smooth' });

  // 9. Gắn lại sự kiện Enter cho search nếu cần
  bindSearchEnter();
}

// --- Gắn sự kiện click cho logo ---
const logo = document.getElementById('logo');
if (logo) {
  logo.addEventListener('click', e => {
    e.preventDefault();
    resetHomePage();
  });
}

// --- Phím tắt phân trang ---
document.addEventListener('keydown', e => {
  const tag = document.activeElement.tagName.toLowerCase();
  if (tag === 'input' || tag === 'textarea') return;

  const totalPages = Math.ceil(currentFiltered.length / ITEMS_PER_PAGE);

  if (e.key === 'ArrowLeft' && currentPage > 1) {
    goToPage(currentPage - 1); // dùng hàm có update URL + lưu
  }

  if (e.key === 'ArrowRight' && currentPage < totalPages) {
    goToPage(currentPage + 1); // dùng hàm có update URL + lưu
  }
});

// --- Đóng player video ---
if (closePlayer) closePlayer.addEventListener('click', closeVideoPlayer);


// -------------------------- GỢI Ý DIỄN VIÊN VÀ TAG--------------------------

searchInput.addEventListener('input', e => {
  const query = e.target.value.trim().toLowerCase();
  if (!query) {
    suggestionsBox.style.display = 'none';
    return;
  }

  // Đếm actor
  const actorCounts = {};
  videos.forEach(video => {
    (video.actors || []).forEach(actor => {
      if (actor.toLowerCase().includes(query)) {
        actorCounts[actor] = (actorCounts[actor] || 0) + 1;
      }
    });
  });
  const matchedActors = Object.entries(actorCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  // Đếm tags (mã code như HUNTB, etc.)
  const tagCounts = {};
  videos.forEach(video => {
    (video.tags || []).forEach(tag => {
      if (tag.toLowerCase().includes(query)) {
        tagCounts[tag] = (tagCounts[tag] || 0) + 1;
      }
    });
  });
  const matchedTags = Object.entries(tagCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  // Đếm genres (thể loại)
  const genreCounts = {};
  videos.forEach(video => {
    (video.genres || []).forEach(genre => {
      if (genre.toLowerCase().includes(query)) {
        genreCounts[genre] = (genreCounts[genre] || 0) + 1;
      }
    });
  });
  const matchedGenres = Object.entries(genreCounts)
    .sort((a, b) => b[1] - a[1])
    .slice(0, 5);

  if (
    matchedActors.length === 0 &&
    matchedTags.length === 0 &&
    matchedGenres.length === 0
  ) {
    suggestionsBox.style.display = 'none';
    return;
  }

  suggestionsBox.innerHTML = '';

  // --- GỢI Ý ACTOR ---
  if (matchedActors.length > 0) {
    const actorHeader = document.createElement('div');
    actorHeader.textContent = 'Tác giả:';
    actorHeader.style.fontWeight = 'bold';
    actorHeader.style.padding = '4px 8px';
    actorHeader.style.color = 'black';
    suggestionsBox.appendChild(actorHeader);

    matchedActors.forEach(([actor]) => {
      const item = document.createElement('div');
      item.innerHTML = `🎭 ${actor}`;
      item.style.padding = '6px 8px';
      item.style.cursor = 'pointer';
      item.style.color = 'black';
      item.addEventListener('mousedown', () => {
        searchInput.value = actor;
        doSearch(actor);
        suggestionsBox.style.display = 'none';
      });
      suggestionsBox.appendChild(item);
    });
  }

// --- GỢI Ý CODE (tags) ---
if (matchedTags.length > 0) {
  const tagHeader = document.createElement('div');
  tagHeader.textContent = 'Code:';
  tagHeader.style.fontWeight = 'bold';
  tagHeader.style.padding = '4px 8px';
  tagHeader.style.color = 'black';
  suggestionsBox.appendChild(tagHeader);

  matchedTags.forEach(([tag, count]) => {
    const item = document.createElement('div');
    item.innerHTML = `🎬 ${tag} | ${count} video`;  // ✅ giữ lại dạng này
    item.style.padding = '6px 8px';
    item.style.cursor = 'pointer';
    item.style.color = 'black';
    item.addEventListener('mousedown', () => {
      searchInput.value = tag;
      doSearch(tag);
      suggestionsBox.style.display = 'none';
    });
    suggestionsBox.appendChild(item);
  });
}

// --- GỢI Ý THỂ LOẠI (genres) ---
if (matchedGenres.length > 0) {
  const genreHeader = document.createElement('div');
  genreHeader.textContent = 'Thể loại:';
  genreHeader.style.fontWeight = 'bold';
  genreHeader.style.padding = '4px 8px';
  genreHeader.style.color = 'black';
  suggestionsBox.appendChild(genreHeader);

  matchedGenres.forEach(([genre, count]) => {  // 👈 cập nhật thành tuple [genre, count]
    const item = document.createElement('div');
    item.innerHTML = `🎬 ${genre} | ${count} video`;  // ✅ thêm count giống như tag
    item.style.padding = '6px 8px';
    item.style.cursor = 'pointer';
    item.style.color = 'black';
    item.addEventListener('mousedown', () => {
      searchInput.value = genre;
      doSearch(genre);
      suggestionsBox.style.display = 'none';
    });
    suggestionsBox.appendChild(item);
  });
}

  // --- HIỂN HỘP GỢI Ý ---
const rect = searchInput.getBoundingClientRect();
const scrollTop  = window.pageYOffset || document.documentElement.scrollTop;
const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

suggestionsBox.style.position = 'absolute';
suggestionsBox.style.top = rect.bottom + scrollTop + 'px';
suggestionsBox.style.left = rect.left + scrollLeft + 'px';
suggestionsBox.style.width = rect.width + 'px';
suggestionsBox.style.background = '#fff';
suggestionsBox.style.border = '1px solid #ccc';
suggestionsBox.style.zIndex = 1000;
suggestionsBox.style.display = 'block';

});

// -------------------------- L1--------------------------
document.getElementById("quick-search-btn").addEventListener("click", () => {
  const input = document.getElementById("search-input");
  const current = input.value.trim().toLowerCase();

  if (current === "l1") {
    // Nếu đã là "l1", xóa input và gửi Enter (tìm rỗng)
    input.value = "";
    input.dispatchEvent(new KeyboardEvent("keydown", { key: "Enter" }));
  } else {
    // Nếu chưa, thì gán "l1" và tìm kiếm
    input.value = "l1";
    input.dispatchEvent(new KeyboardEvent("keydown", { key: "Enter" }));
  }
});

// ------------------ NÚT LỊCH -------------
document.addEventListener('DOMContentLoaded', () => {
  const filterBtn = document.getElementById('year-filter-btn');
  const filterBox = document.getElementById('year-filter-box');
  const closeBtn = document.getElementById('close-filter-box');

  filterBtn.addEventListener('click', () => {
    filterBox.style.display = 'block'; // Hiển thị box
  });

  closeBtn.addEventListener('click', () => {
    filterBox.style.display = 'none'; // Đóng box
  });

  // Ngoài ra, nếu muốn click ra ngoài thì đóng box
  document.addEventListener('click', (e) => {
    if (!filterBox.contains(e.target) && !filterBtn.contains(e.target)) {
      filterBox.style.display = 'none';
    }
  });
});


// ------------------ ẨN LOGO KHI CUỘN TRONG ĐT -------------

document.addEventListener('DOMContentLoaded', function () {
  const logo = document.getElementById('logo');

  function handleScroll() {
    const isMobile = window.innerWidth <= 600;
    if (!isMobile || !logo) return;

    const currentScroll = window.scrollY || document.documentElement.scrollTop;

    if (currentScroll > 10) {
      logo.classList.add('hidden'); // ✅ Ẩn hoàn toàn
    } else {
      logo.classList.remove('hidden'); // ✅ Hiện lại
    }
  }

  window.addEventListener('scroll', handleScroll);
  window.addEventListener('resize', handleScroll);
  handleScroll(); // chạy ban đầu
});

// ------------------ NÚT HOME TRỞ VỀ TRANG TRỦ -------------
document.getElementById('home-btn').addEventListener('click', e => {
  e.preventDefault();

  // 1. Xóa ô tìm kiếm
  const searchInput = document.getElementById('search-input');
  if (searchInput) searchInput.value = '';

  // 2. Reset danh sách video về trạng thái mặc định
  currentFiltered = [...videos].reverse(); // Mới nhất lên đầu
  currentPage = 1;
  renderMoviesPage(currentPage, currentFiltered);

  // 3. Ẩn các hộp liên quan
  const yearBox = document.getElementById('year-filter-box');
  if (yearBox) yearBox.style.display = 'none';

  const actorInfoBox = document.getElementById('actor-info-box');
  if (actorInfoBox) actorInfoBox.style.display = 'none';

  const actorFilterBox = document.getElementById('actor-filter-box');
  if (actorFilterBox) actorFilterBox.style.display = 'none';

  const resultBox = document.getElementById('search-result-box');
  if (resultBox) resultBox.style.display = 'none';

  // 4. Bỏ check lọc "chỉ 1 diễn viên"
  const onlyOneActor = document.getElementById('onlyOneActor');
  if (onlyOneActor) onlyOneActor.checked = false;

  // 5. Tắt player video nếu đang mở
  const player = document.getElementById('playerContainer');
  if (player) {
    player.style.display = 'none';
    const videoFrame = document.getElementById('videoFrame');
    if (videoFrame) videoFrame.src = '';
    document.body.style.overflow = 'auto';
  }

  // 6. Cuộn về đầu trang
  window.scrollTo({ top: 0, behavior: 'smooth' });
});

// ------------------ GỢI Ý DÍNH VÀO THANH TÌM KIẾM -------------
function updateSuggestionBoxPosition() {
  const rect = searchInput.getBoundingClientRect();
  const scrollTop  = window.pageYOffset || document.documentElement.scrollTop;
  const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

  suggestionsBox.style.position = 'absolute';
  suggestionsBox.style.top = rect.bottom + scrollTop + 'px';
  suggestionsBox.style.left = rect.left + scrollLeft + 'px';
  suggestionsBox.style.width = rect.width + 'px';
}
searchInput.addEventListener('input', e => {
  // (phần gợi ý như bạn đã có...)
  updateSuggestionBoxPosition(); // ✅ Gọi mỗi khi gõ
});

window.addEventListener('scroll', updateSuggestionBoxPosition);
window.addEventListener('resize', updateSuggestionBoxPosition);

document.addEventListener('DOMContentLoaded', () => {
  updateSuggestionBoxPosition(); // Đảm bảo đúng vị trí ngay khi load
});

// ------------------ ẨN DANH SÁCH TỔNG CUỐI TRANG -------------

document.getElementById('totalPages').style.display = 'none';

// ------------------ POPUP TẠM BIỆT -------------

function nextPopupPage() {
  if (document.getElementById('popup-page-1').style.display === 'block') {
    document.getElementById('popup-page-1').style.display = 'none';
    document.getElementById('popup-page-2').style.display = 'block';
  } else if (document.getElementById('popup-page-2').style.display === 'block') {
    document.getElementById('popup-page-2').style.display = 'none';
    document.getElementById('popup-page-3').style.display = 'block';
  }
}

function prevPopupPage() {
  if (document.getElementById('popup-page-3').style.display === 'block') {
    document.getElementById('popup-page-3').style.display = 'none';
    document.getElementById('popup-page-2').style.display = 'block';
  } else if (document.getElementById('popup-page-2').style.display === 'block') {
    document.getElementById('popup-page-2').style.display = 'none';
    document.getElementById('popup-page-1').style.display = 'block';
  }
}

function closeWelcomePopup() {
  document.getElementById('popup-welcome').style.display = 'none';
}

window.onload = function () {
  document.getElementById('popup-welcome').style.display = 'flex';
  document.getElementById('popup-page-1').style.display = 'block';
  document.getElementById('popup-page-2').style.display = 'none';
  document.getElementById('popup-page-3').style.display = 'none';
};



// -------------------------- KHỞI ĐỘNG --------------------------

loadCurrentPage();
renderMoviesPage(currentPage, currentFiltered);


document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('search-input');

  // Gắn sự kiện Enter cho search
  if (searchInput) {
    searchInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        const query = searchInput.value.trim();
        suggestionsBox.style.display = 'none';
        if (query) {
          doSearch(query);
        } else {
          currentFiltered = [...videos].reverse();
          goToPage(1);
        }
      }
    });
  }

  // Lấy page và search từ URL
  const params = new URLSearchParams(window.location.search);
  const pageFromURL = parseInt(params.get('page')) || 1;
  const keyword = params.get('search');

  if (!currentFiltered || currentFiltered.length === 0) {
    currentFiltered = [...videos].reverse();
  }

  if (keyword && searchInput) {
    searchInput.value = keyword;
    doSearch(keyword); // Gọi trực tiếp tìm kiếm
  } else {
    renderMoviesPage(pageFromURL, currentFiltered);
  }

  currentPage = pageFromURL;
});

  const updateBtn = document.getElementById('update-btn');
  const updateBox = document.getElementById('update-box');
  const closeUpdateBox = document.getElementById('close-update-box');

  updateBtn.addEventListener('click', () => updateBox.style.display = 'block');
  closeUpdateBox.addEventListener('click', () => updateBox.style.display = 'none');

  // Click ngoài popup đóng
  window.addEventListener('click', (e) => {
    if(e.target === updateBox) updateBox.style.display = 'none';
  });
    </script>
</body>

</html>
